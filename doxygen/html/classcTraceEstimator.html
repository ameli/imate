<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="Doxygen Awesome" />
<meta property="og:image" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta property="og:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<meta property="og:url" content="https://jothepro.github.io/doxygen-awesome-css/" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/348492097/4f16df80-88fb-11eb-9d31-4015ff22c452" />
<meta name="twitter:title" content="Doxygen Awesome" />
<meta name="twitter:description" content="Custom CSS theme for doxygen html-documentation with lots of customization parameters." />
<!-- END twitter metadata -->
<title>imate: cTraceEstimator&lt; DataType &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="toggle-alternative-theme.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js", "TeX/AMSfonts.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom-alternative.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/ameli/imate" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-imate-light.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">imate
   </div>
   <div id="projectbrief">C++/CUDA Reference</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('classcTraceEstimator.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="classcTraceEstimator-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">cTraceEstimator&lt; DataType &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A static class to compute the trace of implicit matrix functions using stochastic Lanczos quadrature method. This class acts as a templated namespace, where the member methods is <em>public</em> and <em>static</em>. The internal private member functions are also static.  
 <a href="classcTraceEstimator.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="c__trace__estimator_8h_source.html">c_trace_estimator.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a29144b4d62c71f0889002754384f57f4"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcTraceEstimator.html#a29144b4d62c71f0889002754384f57f4">c_trace_estimator</a> (<a class="el" href="classcLinearOperator.html">cLinearOperator</a>&lt; DataType &gt; *A, DataType *parameters, const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> num_inquiries, const <a class="el" href="classFunction.html">Function</a> *matrix_function, const <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a> gram, const DataType exponent, const <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a> orthogonalize, const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> lanczos_degree, const DataType lanczos_tol, const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> min_num_samples, const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> max_num_samples, const DataType error_atol, const DataType error_rtol, const DataType confidence_level, const DataType outlier_significance_level, const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> num_threads, DataType *trace, DataType *error, DataType **samples, <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> *processed_samples_indices, <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> *num_samples_used, <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> *num_outliers, <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a> *converged, float &amp;alg_wall_time)</td></tr>
<tr class="memdesc:a29144b4d62c71f0889002754384f57f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stochastic Lanczos quadrature method to estimate trace of a function of a linear operator. Both function and the linear operator can be defined with parameters.  <a href="classcTraceEstimator.html#a29144b4d62c71f0889002754384f57f4">More...</a><br /></td></tr>
<tr class="separator:a29144b4d62c71f0889002754384f57f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:a02afa505a915c58380b99a62e4d56b30"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcTraceEstimator.html#a02afa505a915c58380b99a62e4d56b30">_c_stochastic_lanczos_quadrature</a> (<a class="el" href="classcLinearOperator.html">cLinearOperator</a>&lt; DataType &gt; *A, DataType *parameters, const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> num_inquiries, const <a class="el" href="classFunction.html">Function</a> *matrix_function, const <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a> gram, const DataType exponent, const <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a> orthogonalize, const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> lanczos_degree, const DataType lanczos_tol, <a class="el" href="classRandomNumberGenerator.html">RandomNumberGenerator</a> &amp;random_number_generator, DataType *random_vector, <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a> *converged, DataType *trace_estimate)</td></tr>
<tr class="memdesc:a02afa505a915c58380b99a62e4d56b30"><td class="mdescLeft">&#160;</td><td class="mdescRight">For a given random input vector, computes one Monte-Carlo sample to estimate trace using Lanczos quadrature method.  <a href="classcTraceEstimator.html#a02afa505a915c58380b99a62e4d56b30">More...</a><br /></td></tr>
<tr class="separator:a02afa505a915c58380b99a62e4d56b30"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h3>template&lt;typename DataType&gt;<br />
class cTraceEstimator&lt; DataType &gt;</h3>

<p>A static class to compute the trace of implicit matrix functions using stochastic Lanczos quadrature method. This class acts as a templated namespace, where the member methods is <em>public</em> and <em>static</em>. The internal private member functions are also static. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classDiagonalization.html" title="A static class to find eigenvalues and eigenvectors (diagonalize) tridiagonal and bidiagonal matrices...">Diagonalization</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="c__trace__estimator_8h_source.html#l00039">39</a> of file <a class="el" href="c__trace__estimator_8h_source.html">c_trace_estimator.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a02afa505a915c58380b99a62e4d56b30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02afa505a915c58380b99a62e4d56b30">&#9670;&nbsp;</a></span>_c_stochastic_lanczos_quadrature()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename DataType &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classcTraceEstimator.html">cTraceEstimator</a>&lt; DataType &gt;::_c_stochastic_lanczos_quadrature </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classcLinearOperator.html">cLinearOperator</a>&lt; DataType &gt; *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType *&#160;</td>
          <td class="paramname"><em>parameters</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a>&#160;</td>
          <td class="paramname"><em>num_inquiries</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classFunction.html">Function</a> *&#160;</td>
          <td class="paramname"><em>matrix_function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a>&#160;</td>
          <td class="paramname"><em>gram</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DataType&#160;</td>
          <td class="paramname"><em>exponent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a>&#160;</td>
          <td class="paramname"><em>orthogonalize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a>&#160;</td>
          <td class="paramname"><em>lanczos_degree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DataType&#160;</td>
          <td class="paramname"><em>lanczos_tol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classRandomNumberGenerator.html">RandomNumberGenerator</a> &amp;&#160;</td>
          <td class="paramname"><em>random_number_generator</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType *&#160;</td>
          <td class="paramname"><em>random_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a> *&#160;</td>
          <td class="paramname"><em>converged</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType *&#160;</td>
          <td class="paramname"><em>trace_estimate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>For a given random input vector, computes one Monte-Carlo sample to estimate trace using Lanczos quadrature method. </p>
<dl class="section note"><dt>Note</dt><dd>In special case when an eigenvalue relation is known, this function sets the converged inquiries to "not" converged in order to continue updating those inquiries. This is because in this special case, computing for other inquiries is free.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">A</td><td>An instance of a class derived from <code>LinearOperator</code> class. This object will perform the matrix-vector operation and/or transposed matrix-vector operation for a linear operator. The linear operator can represent a fixed matrix, or a combination of matrices together with some given parameters. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">parameters</td><td>The parameters of the linear operator <code>A</code>. The size of this array is <code>num_parameters*num_inquiries</code> where <code>num_parameters</code> is the number of parameters that define the linear operator <code>A</code>, and <code>num_inquiries</code> is the number of different set of parameters to compute trace on different parametrized operators. The j-th set of parameters are stored in <code>parameters</code>[j*num_parameters:(j+1)*num_parameters]. That is, this array is contiguous over each batch of parameters. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_inquiries</td><td>The number of batches of parameters. This function computes <code>num_inquiries</code> values of trace corresponding to different batch of parameters of the linear operator <code>A</code>. Hence, the number of output trace is <code>num_inquiries</code>. Hence, it is the number of columns of the output array <code>samples</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">matrix_function</td><td>An instance of <code><a class="el" href="classFunction.html" title="Defines the function .">Function</a></code> class which has the function <code>function</code>. This function defines the matrix function, and operates on scalar eigenvalues of the matrix. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gram</td><td>Flag indicating whether the linear operator <code>A</code> is Gramian. If the linear operator is:<ul>
<li>Gramian, then, Lanczos tridiagonalization method is employed. This method requires only matrix-vector multiplication.</li>
<li>not Gramian, then, Golub-Kahn bidiagonalization method is employed. This method requires both matrix and transposed-matrix vector multiplications. </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">exponent</td><td>The exponent parameter <code>p</code> in the trace of the expression \( f((\mathbf{A} + t \mathbf{B})^p) \). The exponent is a real number and by default it is set to <code>1.0</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">orthogonalize</td><td>Indicates whether to orthogonalize the orthogonal eigenvectors during Lanczos recursive iterations.<ul>
<li>If set to <code>0</code>, no orthogonalization is performed.</li>
<li>If set to a negative integer, a newly computed eigenvector is orthogonalized against all the previous eigenvectors (full reorthogonalization).</li>
<li>If set to a positive integer, say <code>q</code> less than <code>lanczos_degree</code>, the newly computed eigenvector is orthogonalized against the last <code>q</code> previous eigenvectors (partial reorthogonalization).</li>
<li>If set to an integer larger than <code>lanczos_degree</code>, it is cut to <code>lanczos_degree</code>, which effectively orthogonalizes against all previous eigenvectors (full reorthogonalization). </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lanczos_degree</td><td>The number of Lanczos recursive iterations. The operator <code>A</code> is reduced to a square tridiagonal (or bidiagonal) matrix of the size <code>lanczos_degree</code>. The eigenvalues (or singular values) of this reduced matrix is computed and used in the stochastic Lanczos quadrature method. The larger Lanczos degre leads to a better estimation. The computational cost is quadratically increases with the lanczos degree. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lanczos_tol</td><td>The tolerance to stop the Lanczos recursive iterations before the end of iterations reached. If the tolerance is not met, the iterations (total of <code>lanczos_degree</code> iterations) continue till end. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">random_number_generator</td><td>Generates random numbers that fills <code>random_vector</code>. In each parallel thread, an independent sequence of random numbers are generated. This object should be initialized by <code>num_threads</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">random_vector</td><td>A 1D vector of the size of matrix <code>A</code>. The Lanczos iterations start off from this random vector. Each given random vector is used per a Monte-Carlo computation of the SLQ method. In the Lanczos iterations, other vectors are generated orthogonal to this initial random vector. This array is filled inside this function. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">converged</td><td>1D array of the size of the number of columns of <code>samples</code>. Each element indicates which column of <code>samples</code> has converged to the tolerance criteria. Normally, if the <code>num_samples</code> used is less than <code>max_num_samples</code>, it indicates that the convergence has reached. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">trace_estimate</td><td>1D array of the size of the number of columns of <code>samples</code> array. This array constitures each row of <code>samples</code> array. Each element of <code>trace_estimates</code> is the estimated trace for each parameter inquiry. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="c__trace__estimator_8cpp_source.html#l00401">401</a> of file <a class="el" href="c__trace__estimator_8cpp_source.html">c_trace_estimator.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;{</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="comment">// Matrix size</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> matrix_size = A-&gt;<a class="code" href="classcLinearOperator.html#aecc5b62db1d8a41f5112b289c7031aaf">get_num_rows</a>();</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="comment">// Fill random vectors with Rademacher distribution (+1, -1), normalized</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// but not orthogonalized. Settng num_threads to zero indicates to not</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// create any new threads in RandomNumbrGenerator since the current</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// function is inside a parallel thread.</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> num_threads = 0;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="classRandomArrayGenerator.html#a3a577526f391d531fe4d66bdfa0107db">RandomArrayGenerator&lt;DataType&gt;::generate_random_array</a>(</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        random_number_generator, random_vector, matrix_size, num_threads);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// Allocate diagonals (alpha) and supdiagonals (beta) of Lanczos matrix</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    DataType* alpha = <span class="keyword">new</span> DataType[lanczos_degree];</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    DataType* beta = <span class="keyword">new</span> DataType[lanczos_degree];</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">// Define 2D arrays needed to decomposition. All these arrays are</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">// defined as 1D array with Fortran ordering</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    DataType* eigenvectors = NULL;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    DataType* left_singularvectors = NULL;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    DataType* right_singularvectors_transposed = NULL;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// Actual number of inquiries</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> required_num_inquiries = num_inquiries;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">if</span> (A-&gt;<a class="code" href="classcLinearOperator.html#af0c980ca87c2795e0dbfda1c84f74591">is_eigenvalue_relation_known</a>())</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="comment">// When a relation between eigenvalues and the parameters of the linear</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="comment">// operator is known, to compute eigenvalues of for each inquiry, only</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="comment">// computing one inquiry is enough. This is because an eigenvalue for</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="comment">// one parameter setting is enough to compute eigenvalue of another set</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="comment">// of parameters.</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        required_num_inquiries = 1;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">// Allocate and initialize theta</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> i;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> j;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    DataType** theta = <span class="keyword">new</span> DataType*[num_inquiries];</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">for</span> (j=0; j &lt; num_inquiries; ++j)</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        theta[j] = <span class="keyword">new</span> DataType[lanczos_degree];</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="comment">// Initialize components to zero</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">for</span> (i=0; i &lt; lanczos_degree; ++i)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            theta[j][i] = 0.0;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">// Allocate and initialize tau</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    DataType** tau = <span class="keyword">new</span> DataType*[num_inquiries];</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">for</span> (j=0; j &lt; num_inquiries; ++j)</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        tau[j] = <span class="keyword">new</span> DataType[lanczos_degree];</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="comment">// Initialize components to zero</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">for</span> (i=0; i &lt; lanczos_degree; ++i)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            tau[j][i] = 0.0;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    }</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment">// Allocate lanczos size for each inquiry. This variable keeps the non-zero</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="comment">// size of the tri-diagonal (or bi-diagonal) matrix. Ideally, this matrix</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="comment">// is of the size lanczos_degree. But, due to the early termination, this</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="comment">// size might be smaller.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a>* lanczos_size = <span class="keyword">new</span> <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a>[num_inquiries];</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="comment">// Number of parameters of linear operator A</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> num_parameters = A-&gt;<a class="code" href="classcLinearOperator.html#af9be60b44a47eed5b2c98f077ff54987">get_num_parameters</a>();</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">// Lanczos iterations, computes theta and tau for each inquiry parameter</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">for</span> (j=0; j &lt; required_num_inquiries; ++j)</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="comment">// If trace is already converged, do not compute on the new sample.</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="comment">// However, exclude the case where required_num_inquiries is not the</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="comment">// same as num_inquiries, since in this case, we compute one inquiry</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="comment">// for multiple parameters.</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">if</span> ((converged[j] == 1) &amp;&amp; (required_num_inquiries == num_inquiries))</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        {</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="comment">// Set parameter of linear operator A</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        A-&gt;<a class="code" href="classcLinearOperator.html#ad7395bd04ec8014c9dd0e66c318ae125">set_parameters</a>(&amp;parameters[j*num_parameters]);</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160; </div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="keywordflow">if</span> (gram)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <span class="comment">// Use Golub-Kahn-Lanczos Bi-diagonalization</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            lanczos_size[j] = <a class="code" href="c__golub__kahn__bidiagonalization_8cpp.html#a6125b021cd93b43ab4d9f20813487f85">c_golub_kahn_bidiagonalization</a>(</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                    A, random_vector, matrix_size, lanczos_degree, lanczos_tol,</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                    orthogonalize, alpha, beta);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <span class="comment">// Allocate matrix of singular vectors (1D array, Fortran ordering)</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            left_singularvectors = \</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                new DataType[lanczos_size[j] * lanczos_size[j]];</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            right_singularvectors_transposed = \</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                new DataType[lanczos_size[j] * lanczos_size[j]];</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160; </div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <span class="comment">// Note: alpha is written in-place with singular values</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            <a class="code" href="classDiagonalization.html#a636b5e32ca7211d60dadc62b2258b8ea">Diagonalization&lt;DataType&gt;::svd_bidiagonal</a>(</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                    alpha, beta, left_singularvectors,</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                    right_singularvectors_transposed, lanczos_size[j]);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <span class="comment">// theta and tau from singular values and vectors</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <span class="keywordflow">for</span> (i=0; i &lt; lanczos_size[j]; ++i)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                theta[j][i] = alpha[i] * alpha[i];</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                tau[j][i] = right_singularvectors_transposed[i];</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <span class="comment">// Use Lanczos Tri-diagonalization</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            lanczos_size[j] = <a class="code" href="c__lanczos__tridiagonalization_8cpp.html#a88831f1a1ba564b198f446a7c8a8d5ef">c_lanczos_tridiagonalization</a>(</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                    A, random_vector, matrix_size, lanczos_degree, lanczos_tol,</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                    orthogonalize, alpha, beta);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <span class="comment">// Allocate eigenvectors matrix (1D array with Fortran ordering)</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            eigenvectors = <span class="keyword">new</span> DataType[lanczos_size[j] * lanczos_size[j]];</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <span class="comment">// Note: alpha is written in-place with eigenvalues</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <a class="code" href="classDiagonalization.html#a18924365b0d74983ead3901886d51204">Diagonalization&lt;DataType&gt;::eigh_tridiagonal</a>(</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                    alpha, beta, eigenvectors, lanczos_size[j]);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <span class="comment">// theta and tau from singular values and vectors</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordflow">for</span> (i=0; i &lt; lanczos_size[j]; ++i)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                theta[j][i] = alpha[i];</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                tau[j][i] = eigenvectors[i * lanczos_size[j]];</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="comment">// If an eigenvalue relation is known, compute the rest of eigenvalues</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">// using the eigenvalue relation given in the operator A for its</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">// eigenvalues. If no eigenvalue relation is not known, the rest of</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="comment">// eigenvalues were already computed in the above loop and no other</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="comment">// computation is needed.</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">if</span> (A-&gt;<a class="code" href="classcLinearOperator.html#af0c980ca87c2795e0dbfda1c84f74591">is_eigenvalue_relation_known</a>() &amp;&amp; num_inquiries &gt; 1)</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    {</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="comment">// When the code execution reaches this function, at least one of the</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="comment">// inquiries is not converged, but some others might have been</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        <span class="comment">// converged already. Here, we force-update those that are even</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="comment">// converged already by setting converged to false. The extra update is</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="comment">// free of charge when a relation for the eigenvalues are known.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordflow">for</span> (j=0; j &lt; num_inquiries; ++j)</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            converged[j] = 0;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        }</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="comment">// Compute theta and tau for the rest of inquiry parameters</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordflow">for</span> (j=1; j &lt; num_inquiries; ++j)</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <span class="comment">// Only j=0 was iterated before. Set the same size for other j-s</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            lanczos_size[j] = lanczos_size[0];</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160; </div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <span class="keywordflow">for</span> (i=0; i &lt; lanczos_size[j]; ++i)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                <span class="comment">// Shift eigenvalues by the old and new parameters</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                theta[j][i] = A-&gt;<a class="code" href="classcLinearOperator.html#a0dd6306a434563e4a48a806b43f23d03">get_eigenvalue</a>(</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                        &amp;parameters[0],</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                        theta[0][i],</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                        &amp;parameters[j*num_parameters]);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                <span class="comment">// tau is the same (at least for the affine operator)</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                tau[j][i] = tau[0][i];</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    }</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">// Estimate trace using quadrature method</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    DataType quadrature_sum;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">for</span> (j=0; j &lt; num_inquiries; ++j)</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="comment">// If the j-th inquiry is already converged, skip.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="keywordflow">if</span> (converged[j] == 1)</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        {</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        }</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160; </div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="comment">// Initialize sum for the integral of quadrature</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        quadrature_sum = 0.0;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="comment">// Important: This loop should iterate till lanczos_size[j], but not</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="comment">// lanczos_degree. Otherwise the computation is wrong for certain</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <span class="comment">// matrices, such as if the input matrix is identity, or rank</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="comment">// deficient. By using lanczos_size[j] instead of lanczos_degree, all</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="comment">// issues with special matrices will resolve.</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordflow">for</span> (i=0; i &lt; lanczos_size[j]; ++i)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            quadrature_sum += tau[j][i] * tau[j][i] * \</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                    matrix_function-&gt;function(pow(theta[j][i], exponent));</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        trace_estimate[j] = matrix_size * quadrature_sum;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="comment">// Release dynamic memory</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keyword">delete</span>[] alpha;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keyword">delete</span>[] beta;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keyword">delete</span>[] lanczos_size;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">for</span> (j=0; j &lt; required_num_inquiries; ++j)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keyword">delete</span>[] theta[j];</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keyword">delete</span>[] theta;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">for</span> (j=0; j &lt; required_num_inquiries; ++j)</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keyword">delete</span>[] tau[j];</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keyword">delete</span>[] tau;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">if</span> (eigenvectors != NULL)</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keyword">delete</span>[] eigenvectors;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    }</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordflow">if</span> (left_singularvectors != NULL)</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    {</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keyword">delete</span>[] left_singularvectors;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keywordflow">if</span> (right_singularvectors_transposed != NULL)</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keyword">delete</span>[] right_singularvectors_transposed;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    }</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;}</div>
<div class="ttc" id="ac__golub__kahn__bidiagonalization_8cpp_html_a6125b021cd93b43ab4d9f20813487f85"><div class="ttname"><a href="c__golub__kahn__bidiagonalization_8cpp.html#a6125b021cd93b43ab4d9f20813487f85">c_golub_kahn_bidiagonalization</a></div><div class="ttdeci">IndexType c_golub_kahn_bidiagonalization(cLinearOperator&lt; DataType &gt; *A, const DataType *v, const LongIndexType n, const IndexType m, const DataType lanczos_tol, const FlagType orthogonalize, DataType *alpha, DataType *beta)</div><div class="ttdoc">Bi-diagonalizes the positive-definite matrix A using Golub-Kahn-Lanczos method.</div><div class="ttdef"><b>Definition:</b> <a href="c__golub__kahn__bidiagonalization_8cpp_source.html#l00111">c_golub_kahn_bidiagonalization.cpp:111</a></div></div>
<div class="ttc" id="ac__lanczos__tridiagonalization_8cpp_html_a88831f1a1ba564b198f446a7c8a8d5ef"><div class="ttname"><a href="c__lanczos__tridiagonalization_8cpp.html#a88831f1a1ba564b198f446a7c8a8d5ef">c_lanczos_tridiagonalization</a></div><div class="ttdeci">IndexType c_lanczos_tridiagonalization(cLinearOperator&lt; DataType &gt; *A, const DataType *v, const LongIndexType n, const IndexType m, const DataType lanczos_tol, const FlagType orthogonalize, DataType *alpha, DataType *beta)</div><div class="ttdoc">Tri-diagonalizes matrix A to T using the start vector v. is the Lanczos degree, which will be the siz...</div><div class="ttdef"><b>Definition:</b> <a href="c__lanczos__tridiagonalization_8cpp_source.html#l00117">c_lanczos_tridiagonalization.cpp:117</a></div></div>
<div class="ttc" id="aclassDiagonalization_html_a18924365b0d74983ead3901886d51204"><div class="ttname"><a href="classDiagonalization.html#a18924365b0d74983ead3901886d51204">Diagonalization::eigh_tridiagonal</a></div><div class="ttdeci">static int eigh_tridiagonal(DataType *diagonals, DataType *subdiagonals, DataType *eigenvectors, IndexType matrix_size)</div><div class="ttdoc">Computes all eigenvalues and eigenvectors of a real and symmetric tridiagonal matrix.</div><div class="ttdef"><b>Definition:</b> <a href="diagonalization_8cpp_source.html#l00089">diagonalization.cpp:89</a></div></div>
<div class="ttc" id="aclassDiagonalization_html_a636b5e32ca7211d60dadc62b2258b8ea"><div class="ttname"><a href="classDiagonalization.html#a636b5e32ca7211d60dadc62b2258b8ea">Diagonalization::svd_bidiagonal</a></div><div class="ttdeci">static int svd_bidiagonal(DataType *diagonals, DataType *subdiagonals, DataType *U, DataType *Vt, IndexType matrix_size)</div><div class="ttdoc">Computes all singular-values and left and right eigenvectors of a real and symmetric upper bi-diagona...</div><div class="ttdef"><b>Definition:</b> <a href="diagonalization_8cpp_source.html#l00190">diagonalization.cpp:190</a></div></div>
<div class="ttc" id="aclassRandomArrayGenerator_html_a3a577526f391d531fe4d66bdfa0107db"><div class="ttname"><a href="classRandomArrayGenerator.html#a3a577526f391d531fe4d66bdfa0107db">RandomArrayGenerator::generate_random_array</a></div><div class="ttdeci">static void generate_random_array(RandomNumberGenerator &amp;random_number_generator, DataType *array, const LongIndexType array_size, const IndexType num_threads)</div><div class="ttdoc">Generates a pseudo-random array with Rademacher distribution where elements are either +1 or -1.</div><div class="ttdef"><b>Definition:</b> <a href="random__array__generator_8cpp_source.html#l00063">random_array_generator.cpp:63</a></div></div>
<div class="ttc" id="aclasscLinearOperator_html_a0dd6306a434563e4a48a806b43f23d03"><div class="ttname"><a href="classcLinearOperator.html#a0dd6306a434563e4a48a806b43f23d03">cLinearOperator::get_eigenvalue</a></div><div class="ttdeci">virtual DataType get_eigenvalue(const DataType *known_parameters, const DataType known_eigenvalue, const DataType *inquiry_parameters) const =0</div></div>
<div class="ttc" id="aclasscLinearOperator_html_ad7395bd04ec8014c9dd0e66c318ae125"><div class="ttname"><a href="classcLinearOperator.html#ad7395bd04ec8014c9dd0e66c318ae125">cLinearOperator::set_parameters</a></div><div class="ttdeci">void set_parameters(DataType *parameters_)</div><div class="ttdoc">Sets the scalar parameter this-&gt;parameters. Parameter is initialized to NULL. However,...</div><div class="ttdef"><b>Definition:</b> <a href="c__linear__operator_8cpp_source.html#l00108">c_linear_operator.cpp:108</a></div></div>
<div class="ttc" id="aclasscLinearOperator_html_aecc5b62db1d8a41f5112b289c7031aaf"><div class="ttname"><a href="classcLinearOperator.html#aecc5b62db1d8a41f5112b289c7031aaf">cLinearOperator::get_num_rows</a></div><div class="ttdeci">LongIndexType get_num_rows() const</div><div class="ttdef"><b>Definition:</b> <a href="c__linear__operator_8cpp_source.html#l00079">c_linear_operator.cpp:79</a></div></div>
<div class="ttc" id="aclasscLinearOperator_html_af0c980ca87c2795e0dbfda1c84f74591"><div class="ttname"><a href="classcLinearOperator.html#af0c980ca87c2795e0dbfda1c84f74591">cLinearOperator::is_eigenvalue_relation_known</a></div><div class="ttdeci">FlagType is_eigenvalue_relation_known() const</div><div class="ttdoc">Returns a flag that determines whether a relation between the parameters of the operator and its eige...</div><div class="ttdef"><b>Definition:</b> <a href="c__linear__operator_8cpp_source.html#l00136">c_linear_operator.cpp:136</a></div></div>
<div class="ttc" id="aclasscLinearOperator_html_af9be60b44a47eed5b2c98f077ff54987"><div class="ttname"><a href="classcLinearOperator.html#af9be60b44a47eed5b2c98f077ff54987">cLinearOperator::get_num_parameters</a></div><div class="ttdeci">IndexType get_num_parameters() const</div><div class="ttdef"><b>Definition:</b> <a href="c__linear__operator_8cpp_source.html#l00119">c_linear_operator.cpp:119</a></div></div>
<div class="ttc" id="atypes_8h_html_ab1b7173c76e5040d0161e695a129dafe"><div class="ttname"><a href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a></div><div class="ttdeci">int IndexType</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00065">types.h:65</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="c__golub__kahn__bidiagonalization_8cpp_source.html#l00111">c_golub_kahn_bidiagonalization()</a>, <a class="el" href="c__lanczos__tridiagonalization_8cpp_source.html#l00117">c_lanczos_tridiagonalization()</a>, <a class="el" href="diagonalization_8cpp_source.html#l00089">Diagonalization&lt; DataType &gt;::eigh_tridiagonal()</a>, <a class="el" href="random__array__generator_8cpp_source.html#l00063">RandomArrayGenerator&lt; DataType &gt;::generate_random_array()</a>, <a class="el" href="classcLinearOperator.html#a0dd6306a434563e4a48a806b43f23d03">cLinearOperator&lt; DataType &gt;::get_eigenvalue()</a>, <a class="el" href="c__linear__operator_8cpp_source.html#l00119">cLinearOperator&lt; DataType &gt;::get_num_parameters()</a>, <a class="el" href="c__linear__operator_8cpp_source.html#l00079">cLinearOperator&lt; DataType &gt;::get_num_rows()</a>, <a class="el" href="c__linear__operator_8cpp_source.html#l00136">cLinearOperator&lt; DataType &gt;::is_eigenvalue_relation_known()</a>, <a class="el" href="c__linear__operator_8cpp_source.html#l00108">cLinearOperator&lt; DataType &gt;::set_parameters()</a>, and <a class="el" href="diagonalization_8cpp_source.html#l00190">Diagonalization&lt; DataType &gt;::svd_bidiagonal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="c__trace__estimator_8cpp_source.html#l00183">cTraceEstimator&lt; DataType &gt;::c_trace_estimator()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classcTraceEstimator_a02afa505a915c58380b99a62e4d56b30_cgraph.png" border="0" usemap="#aclasscTraceEstimator_a02afa505a915c58380b99a62e4d56b30_cgraph" alt=""/></div>
<map name="aclasscTraceEstimator_a02afa505a915c58380b99a62e4d56b30_cgraph" id="aclasscTraceEstimator_a02afa505a915c58380b99a62e4d56b30_cgraph">
<area shape="rect" title="For a given random input vector, computes one Monte&#45;Carlo sample to estimate trace using Lanczos quad..." alt="" coords="5,718,156,774"/>
<area shape="rect" href="c__golub__kahn__bidiagonalization_8cpp.html#a6125b021cd93b43ab4d9f20813487f85" title="Bi&#45;diagonalizes the positive&#45;definite matrix A using Golub&#45;Kahn&#45;Lanczos method." alt="" coords="204,187,433,214"/>
<area shape="rect" href="c__lanczos__tridiagonalization_8cpp.html#a88831f1a1ba564b198f446a7c8a8d5ef" title="Tri&#45;diagonalizes matrix A to T using the start vector v. is the Lanczos degree, which will be the siz..." alt="" coords="215,430,422,457"/>
<area shape="rect" href="classDiagonalization.html#a18924365b0d74983ead3901886d51204" title="Computes all eigenvalues and eigenvectors of a real and symmetric tridiagonal matrix." alt="" coords="239,561,399,603"/>
<area shape="rect" href="classRandomArrayGenerator.html#a3a577526f391d531fe4d66bdfa0107db" title="Generates a pseudo&#45;random array with Rademacher distribution where elements are either +1 or &#45;1." alt="" coords="225,627,412,668"/>
<area shape="rect" href="classcLinearOperator.html#a0dd6306a434563e4a48a806b43f23d03" title=" " alt="" coords="241,692,396,733"/>
<area shape="rect" href="classcLinearOperator.html#af9be60b44a47eed5b2c98f077ff54987" title=" " alt="" coords="241,757,396,799"/>
<area shape="rect" href="classcLinearOperator.html#aecc5b62db1d8a41f5112b289c7031aaf" title=" " alt="" coords="241,823,396,864"/>
<area shape="rect" href="classcLinearOperator.html#af0c980ca87c2795e0dbfda1c84f74591" title="Returns a flag that determines whether a relation between the parameters of the operator and its eige..." alt="" coords="215,888,423,929"/>
<area shape="rect" href="classcLinearOperator.html#ad7395bd04ec8014c9dd0e66c318ae125" title="Sets the scalar parameter this&#45;&gt;parameters. Parameter is initialized to NULL. However,..." alt="" coords="241,953,396,995"/>
<area shape="rect" href="classDiagonalization.html#a636b5e32ca7211d60dadc62b2258b8ea" title="Computes all singular&#45;values and left and right eigenvectors of a real and symmetric upper bi&#45;diagona..." alt="" coords="241,1019,396,1060"/>
<area shape="rect" href="classcLinearOperator.html#a48c76860a74f00fefaa1297368d17a77" title=" " alt="" coords="517,238,672,265"/>
<area shape="rect" href="classcOrthogonalization.html#a1b1bcbb636f1a1608ce7a22d4538b3b3" title="Modified Gram&#45;Schmidt orthogonalization process to orthogonalize the vector v against a subset of the..." alt="" coords="505,391,685,432"/>
<area shape="rect" href="classcVectorOperations.html#a9bd28bd08f5a6b096d99a4a2f7d23e90" title="Subtracts the scaled input vector from the output vector." alt="" coords="756,391,928,432"/>
<area shape="rect" href="classcVectorOperations.html#aeb0171f2644e3036907bbbddf47ce998" title="Normalizes a vector based on Euclidean 2&#45;norm. The result is written into another vector." alt="" coords="493,71,697,112"/>
<area shape="rect" href="classcVectorOperations.html#ab0991d74cadf3a3969f0723dbff55dc9" title="Normalizes a vector based on Euclidean 2&#45;norm. The result is written in&#45;place." alt="" coords="497,5,693,47"/>
<area shape="rect" href="classcLinearOperator.html#a40f5051c4399ebfa153ef7147e10a6e6" title=" " alt="" coords="481,137,708,163"/>
<area shape="rect" href="classcVectorOperations.html#abd0d2c941f9d3598f42026755cbc4709" title="Computes the Euclidean norm of a 1D array." alt="" coords="767,119,917,160"/>
<area shape="rect" href="classcVectorOperations.html#ab8b945baba573b4479e8095ca87f8b3f" title="Computes Euclidean inner product of two vectors." alt="" coords="767,511,917,552"/>
<area shape="rect" href="classcVectorOperations.html#a6627fe95659faa224dca2af1dab1fab3" title="Scales a vector and stores to a new vector." alt="" coords="767,231,917,272"/>
<area shape="rect" href="classcVectorOperations.html#a492894cdc368a4f60b28aa15109cf9bc" title="Copies a vector to a new vector. Result is written in&#45;place." alt="" coords="520,456,669,497"/>
<area shape="rect" href="lapack__api_8h.html#a829a495cf9df4ce926be95ee1c6163a8" title=" " alt="" coords="541,623,649,650"/>
<area shape="rect" href="classRandomNumberGenerator.html#a91d8b9726bda7dcd40f9b992b2a1bccd" title="Generates the next random number in the sequence, depending on the thread id." alt="" coords="498,675,691,716"/>
<area shape="rect" href="classXoshiro256StarStar.html#a6a99f74d2ed5f6e3667d785c46bf9569" title="Generates the next presudo&#45;random number." alt="" coords="769,675,915,716"/>
<area shape="rect" href="classXoshiro256StarStar.html#a3b10c22cbac4ff9bf4447e28e57f7a72" title="Rotates the bits of a 64 bit integer toward left." alt="" coords="976,675,1123,716"/>
<area shape="rect" href="lapack__api_8h.html#a14ad2b140c825a35e626fadf98fe495b" title=" " alt="" coords="535,1026,654,1053"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classcTraceEstimator_a02afa505a915c58380b99a62e4d56b30_icgraph.png" border="0" usemap="#aclasscTraceEstimator_a02afa505a915c58380b99a62e4d56b30_icgraph" alt=""/></div>
<map name="aclasscTraceEstimator_a02afa505a915c58380b99a62e4d56b30_icgraph" id="aclasscTraceEstimator_a02afa505a915c58380b99a62e4d56b30_icgraph">
<area shape="rect" title="For a given random input vector, computes one Monte&#45;Carlo sample to estimate trace using Lanczos quad..." alt="" coords="195,5,345,61"/>
<area shape="rect" href="classcTraceEstimator.html#a29144b4d62c71f0889002754384f57f4" title="Stochastic Lanczos quadrature method to estimate trace of a function of a linear operator...." alt="" coords="5,13,147,54"/>
</map>
</div>

</div>
</div>
<a id="a29144b4d62c71f0889002754384f57f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29144b4d62c71f0889002754384f57f4">&#9670;&nbsp;</a></span>c_trace_estimator()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename DataType &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a> <a class="el" href="classcTraceEstimator.html">cTraceEstimator</a>&lt; DataType &gt;::c_trace_estimator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classcLinearOperator.html">cLinearOperator</a>&lt; DataType &gt; *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType *&#160;</td>
          <td class="paramname"><em>parameters</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a>&#160;</td>
          <td class="paramname"><em>num_inquiries</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classFunction.html">Function</a> *&#160;</td>
          <td class="paramname"><em>matrix_function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a>&#160;</td>
          <td class="paramname"><em>gram</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DataType&#160;</td>
          <td class="paramname"><em>exponent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a>&#160;</td>
          <td class="paramname"><em>orthogonalize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a>&#160;</td>
          <td class="paramname"><em>lanczos_degree</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DataType&#160;</td>
          <td class="paramname"><em>lanczos_tol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a>&#160;</td>
          <td class="paramname"><em>min_num_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a>&#160;</td>
          <td class="paramname"><em>max_num_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DataType&#160;</td>
          <td class="paramname"><em>error_atol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DataType&#160;</td>
          <td class="paramname"><em>error_rtol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DataType&#160;</td>
          <td class="paramname"><em>confidence_level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DataType&#160;</td>
          <td class="paramname"><em>outlier_significance_level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a>&#160;</td>
          <td class="paramname"><em>num_threads</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType *&#160;</td>
          <td class="paramname"><em>trace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType *&#160;</td>
          <td class="paramname"><em>error</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DataType **&#160;</td>
          <td class="paramname"><em>samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> *&#160;</td>
          <td class="paramname"><em>processed_samples_indices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> *&#160;</td>
          <td class="paramname"><em>num_samples_used</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> *&#160;</td>
          <td class="paramname"><em>num_outliers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a> *&#160;</td>
          <td class="paramname"><em>converged</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float &amp;&#160;</td>
          <td class="paramname"><em>alg_wall_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stochastic Lanczos quadrature method to estimate trace of a function of a linear operator. Both function and the linear operator can be defined with parameters. </p>
<p>Multiple batches of parameters of the linear operator can be passed to this function. In such a case, the output trace is an array of the of the number of the inquired parameters.</p>
<p>The stochastic estimator computes multiple samples of trace and the final result is the average of the samples. This function outputs both the samples of estimated trace values (in <code>samples</code> array) and their average (in <code>trace</code> array).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">A</td><td>An instance of a class derived from <code>LinearOperator</code> class. This object will perform the matrix-vector operation and/or transposed matrix-vector operation for a linear operator. The linear operator can represent a fixed matrix, or a combination of matrices together with some given parameters. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">parameters</td><td>The parameters of the linear operator <code>A</code>. The size of this array is <code>num_parameters*num_inquiries</code> where <code>num_parameters</code> is the number of parameters that define the linear operator <code>A</code>, and <code>num_inquiries</code> is the number of different set of parameters to compute trace on different parametrized operators. The j-th set of parameters are stored in <code>parameters</code>[j*num_parameters:(j+1)*num_parameters]. That is, this array is contiguous over each batch of parameters. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_inquiries</td><td>The number of batches of parameters. This function computes <code>num_inquiries</code> values of trace corresponding to different batch of parameters of the linear operator <code>A</code>. Hence, the number of output trace is <code>num_inquiries</code>. Hence, it is the number of columns of the output array <code>samples</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">matrix_function</td><td>An instance of <code><a class="el" href="classFunction.html" title="Defines the function .">Function</a></code> class which has the function <code>function</code>. This function defines the matrix function, and operates on scalar eigenvalues of the matrix. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gram</td><td>Flag indicating whether the linear operator <code>A</code> is Gramian. If the linear operator is:<ul>
<li>Gramian, then, Lanczos tridiagonalization method is employed. This method requires only matrix-vector multiplication.</li>
<li>not Gramian, then, Golub-Kahn bidiagonalization method is employed. This method requires both matrix and transposed-matrix vector multiplications. </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">exponent</td><td>The exponent parameter <code>p</code> in the trace of the expression \( f((\mathbf{A} + t \mathbf{B})^p) \). The exponent is a real number and by default it is set to <code>1.0</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">orthogonalize</td><td>Indicates whether to orthogonalize the orthogonal eigenvectors during Lanczos recursive iterations.<ul>
<li>If set to <code>0</code>, no orthogonalization is performed.</li>
<li>If set to a negative integer, a newly computed eigenvector is orthogonalized against all the previous eigenvectors (full reorthogonalization).</li>
<li>If set to a positive integer, say <code>q</code> less than <code>lanczos_degree</code>, the newly computed eigenvector is orthogonalized against the last <code>q</code> previous eigenvectors (partial reorthogonalization).</li>
<li>If set to an integer larger than <code>lanczos_degree</code>, it is cut to <code>lanczos_degree</code>, which effectively orthogonalizes against all previous eigenvectors (full reorthogonalization). </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lanczos_degree</td><td>The number of Lanczos recursive iterations. The operator <code>A</code> is reduced to a square tridiagonal (or bidiagonal) matrix of the size <code>lanczos_degree</code>. The eigenvalues (or singular values) of this reduced matrix is computed and used in the stochastic Lanczos quadrature method. The larger Lanczos degree leads to a better estimation. The computational cost is quadratically increases with the lanczos degree. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lanczos_tol</td><td>The tolerance to stop the Lanczos recursive iterations before the end of iterations reached. If the tolerance is not met, the iterations (total of <code>lanczos_degree</code> iterations) continue till end. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">min_num_samples</td><td>Minimum number of times that the trace estimation is repeated. Within the min number of samples, the Monte-Carlo continues even if convergence is reached. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_num_samples</td><td>The number of times that the trace estimation is repeated. The output trace value is the average of the samples. Hence, this is the number of rows of the output array <code>samples</code>. Larger number of samples leads to a better trace estimation. The computational const linearly increases with number of samples. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">error_atol</td><td>Absolute tolerance criterion for early termination during the computation of trace samples. If the tolerance is not met, then all iterations (total of <code>max_num_samples</code>) proceed till end. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">error_rtol</td><td>Relative tolerance criterion for early termination during the computation of trace samples. If the tolerance is not met, then all iterations (total of <code>max_num_samples</code>) proceed till end. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">confidence_level</td><td>The confidence level of the error, which is a number between <code>0</code> and <code>1</code>. This affects the scale of <code>error</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">outlier_significance_level</td><td>One minus the confidence level of the uncertainty band of the outlier. This is a number between <code>0</code> and <code>1</code>. Confidence level of outleir and significance level of outlier are complement of each other. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_threads</td><td>Number of OpenMP parallel processes. The parallelization is implemented over the Monte-Carlo iterations. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">trace</td><td>The output trace of size <code>num_inquiries</code>. These values are the average of the rows of <code>samples</code> array. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">error</td><td>The error of estimation of trace, which is the standard deviation of the rows of <code>samples</code> array. The size of this array is <code>num_inquiries</code>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">samples</td><td>2D array of all estimated trace samples. The shape of this array is <code></code>(max_num_samples*num_inquiries). The average of the rows is also given in <code>trace</code> array. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">processed_samples_indices</td><td>A 1D array indicating the processing order of rows of the <code>samples</code>. In parallel processing, this order of processing the rows of <code>samples</code> is not necessarly sequential. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">num_samples_used</td><td>1D array of the size of the number of columns of <code>samples</code>. Each element indicates how many iterations were used till convergence is reached for each column of the <code>samples</code>. The number of iterations should be a number between <code>min_num_samples</code> and <code>max_num_samples</code>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">num_outliers</td><td>1D array with the size of number of columns of <code>samples</code>. Each element indicates how many rows of the <code>samples</code> array were outliers and were removed during averaging rows of <code>samples</code>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">converged</td><td>1D array of the size of the number of columns of <code>samples</code>. Each element indicates which column of <code>samples</code> has converged to the tolerance criteria. Normally, if the <code>num_samples</code> used is less than <code>max_num_samples</code>, it indicates that the convergence has reached. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">alg_wall_time</td><td>The elapsed time that takes for the SLQ algorithm. This does not include array allocation/deallocation. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A signal to indicate the status of computation:<ul>
<li><code>1</code> indicates successful convergence within the given tolerances was met. Convergence is achieved when all elements of <code>convergence</code> array are below <code>convergence_atol</code> or <code>convergence_rtol</code> times <code>trace</code>.</li>
<li><code>0</code> indicates the convergence criterion was not met for at least one of the trace inquiries. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="c__trace__estimator_8cpp_source.html#l00183">183</a> of file <a class="el" href="c__trace__estimator_8cpp_source.html">c_trace_estimator.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;{</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// Matrix size</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> matrix_size = A-&gt;<a class="code" href="classcLinearOperator.html#aecc5b62db1d8a41f5112b289c7031aaf">get_num_rows</a>();</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// Set the number of threads</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    omp_set_num_threads(num_threads);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// Allocate 1D array of random vectors We only allocate a random vector</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="comment">// per parallel thread. Thus, the total size of the random vectors is</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">// matrix_size*num_threads. On each iteration in parallel threads, the</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="comment">// alocated memory is resued. That is, in each iteration, a new random</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="comment">// vector is generated for that specific thread id.</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> random_vectors_size = matrix_size * num_threads;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    DataType* random_vectors = <span class="keyword">new</span> DataType[random_vectors_size];</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// Initialize random number generator to generate in parallel threads</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="comment">// independently.</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="classRandomNumberGenerator.html">RandomNumberGenerator</a> random_number_generator(num_threads);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// The counter of filled size of processed_samples_indices array</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">// This scalar variable is defined as array to be shared among al threads</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> num_processed_samples = 0;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="comment">// Criterion for early termination of iterations if convergence reached</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">// This scalar variable is defined as array to be shared among al threads</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a> all_converged = 0;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="comment">// Using square-root of max possible chunk size for parallel schedules</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> chunk_size = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            sqrt(<span class="keyword">static_cast&lt;</span>DataType<span class="keyword">&gt;</span>(max_num_samples) / num_threads));</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span> (chunk_size &lt; 1)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        chunk_size = 1;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">// Timing elapsed time of algorithm</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="classTimer.html">Timer</a> timer;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    timer.<a class="code" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">start</a>();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// Shared-memory parallelism over Monte-Carlo ensemble sampling</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="types_8h.html#ab1b7173c76e5040d0161e695a129dafe">IndexType</a> i;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="preprocessor">    #pragma omp parallel for schedule(dynamic, chunk_size)</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">for</span> (i=0; i &lt; max_num_samples; ++i)</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span> (!<span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(all_converged))</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="keywordtype">int</span> thread_id = omp_get_thread_num();</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            <span class="comment">// Perform one Monte-Carlo sampling to estimate trace</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            <a class="code" href="classcTraceEstimator.html#a02afa505a915c58380b99a62e4d56b30">cTraceEstimator&lt;DataType&gt;::_c_stochastic_lanczos_quadrature</a>(</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    A, parameters, num_inquiries, matrix_function, gram,</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    exponent, orthogonalize, lanczos_degree, lanczos_tol,</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    random_number_generator,</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                    &amp;random_vectors[matrix_size*thread_id], converged,</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                    samples[i]);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="comment">// Critical section</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="preprocessor">            #pragma omp critical</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <span class="comment">// Store the index of processed samples</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                processed_samples_indices[num_processed_samples] = i;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                ++num_processed_samples;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="comment">// Check whether convergence criterion has been met to stop.</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="comment">// This check can also be done after another parallel thread</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                <span class="comment">// set all_converged to &quot;1&quot;, but we continue to update error.</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                all_converged = <a class="code" href="classConvergenceTools.html#a5a0602ee4f933a4521ccf9ea137dd191">ConvergenceTools&lt;DataType&gt;::check_convergence</a>(</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        samples, min_num_samples, num_inquiries,</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        processed_samples_indices, num_processed_samples,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                        confidence_level, error_atol, error_rtol, error,</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                        num_samples_used, converged);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// Elapsed wall time of the algorithm (computation only, not array i/o)</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    timer.<a class="code" href="classTimer.html#a63f0eb44b27402196590a03781515dba">stop</a>();</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    alg_wall_time = timer.<a class="code" href="classTimer.html#a6a89a613c2af9b0d1e5f7e4ba9e46c54">elapsed</a>();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// Remove outliers from trace estimates and average trace estimates</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="classConvergenceTools.html#a88ae9fc09aa9af950d41cf803934c028">ConvergenceTools&lt;DataType&gt;::average_estimates</a>(</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            confidence_level, outlier_significance_level, num_inquiries,</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            max_num_samples, num_samples_used, processed_samples_indices,</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            samples, num_outliers, trace, error);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="comment">// Deallocate memory</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keyword">delete</span>[] random_vectors;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">return</span> all_converged;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div>
<div class="ttc" id="aclassConvergenceTools_html_a5a0602ee4f933a4521ccf9ea137dd191"><div class="ttname"><a href="classConvergenceTools.html#a5a0602ee4f933a4521ccf9ea137dd191">ConvergenceTools::check_convergence</a></div><div class="ttdeci">static FlagType check_convergence(DataType **samples, const IndexType min_num_samples, const IndexType num_inquiries, const IndexType *processed_samples_indices, const IndexType num_processed_samples, const DataType confidence_level, const DataType error_atol, const DataType error_rtol, DataType *error, IndexType *num_samples_used, FlagType *converged)</div><div class="ttdoc">Checks if the standard deviation of the set of the cumulative averages of trace estimators converged ...</div><div class="ttdef"><b>Definition:</b> <a href="convergence__tools_8cpp_source.html#l00095">convergence_tools.cpp:95</a></div></div>
<div class="ttc" id="aclassConvergenceTools_html_a88ae9fc09aa9af950d41cf803934c028"><div class="ttname"><a href="classConvergenceTools.html#a88ae9fc09aa9af950d41cf803934c028">ConvergenceTools::average_estimates</a></div><div class="ttdeci">static void average_estimates(const DataType confidence_level, const DataType outlier_significance_level, const IndexType num_inquiries, const IndexType max_num_samples, const IndexType *num_samples_used, const IndexType *processed_samples_indices, DataType **samples, IndexType *num_outliers, DataType *trace, DataType *error)</div><div class="ttdoc">Averages the estimates of trace. Removes outliers and reevaluates the error to take into account for ...</div><div class="ttdef"><b>Definition:</b> <a href="convergence__tools_8cpp_source.html#l00256">convergence_tools.cpp:256</a></div></div>
<div class="ttc" id="aclassRandomNumberGenerator_html"><div class="ttname"><a href="classRandomNumberGenerator.html">RandomNumberGenerator</a></div><div class="ttdoc">Generates 64-bit integers on multiple parallel threads.</div><div class="ttdef"><b>Definition:</b> <a href="random__number__generator_8h_source.html#l00103">random_number_generator.h:104</a></div></div>
<div class="ttc" id="aclassTimer_html"><div class="ttname"><a href="classTimer.html">Timer</a></div><div class="ttdoc">Records elasped wall time between two events.</div><div class="ttdef"><b>Definition:</b> <a href="timer_8h_source.html#l00049">timer.h:50</a></div></div>
<div class="ttc" id="aclassTimer_html_a3a8b5272198d029779dc9302a54305a8"><div class="ttname"><a href="classTimer.html#a3a8b5272198d029779dc9302a54305a8">Timer::start</a></div><div class="ttdeci">void start()</div><div class="ttdoc">Starts the timer.</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cpp_source.html#l00066">timer.cpp:66</a></div></div>
<div class="ttc" id="aclassTimer_html_a63f0eb44b27402196590a03781515dba"><div class="ttname"><a href="classTimer.html#a63f0eb44b27402196590a03781515dba">Timer::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdoc">Stops the timer.</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cpp_source.html#l00079">timer.cpp:79</a></div></div>
<div class="ttc" id="aclassTimer_html_a6a89a613c2af9b0d1e5f7e4ba9e46c54"><div class="ttname"><a href="classTimer.html#a6a89a613c2af9b0d1e5f7e4ba9e46c54">Timer::elapsed</a></div><div class="ttdeci">double elapsed() const</div><div class="ttdoc">Returns the elapsed time in seconds.</div><div class="ttdef"><b>Definition:</b> <a href="timer_8cpp_source.html#l00092">timer.cpp:92</a></div></div>
<div class="ttc" id="aclasscTraceEstimator_html_a02afa505a915c58380b99a62e4d56b30"><div class="ttname"><a href="classcTraceEstimator.html#a02afa505a915c58380b99a62e4d56b30">cTraceEstimator::_c_stochastic_lanczos_quadrature</a></div><div class="ttdeci">static void _c_stochastic_lanczos_quadrature(cLinearOperator&lt; DataType &gt; *A, DataType *parameters, const IndexType num_inquiries, const Function *matrix_function, const FlagType gram, const DataType exponent, const FlagType orthogonalize, const IndexType lanczos_degree, const DataType lanczos_tol, RandomNumberGenerator &amp;random_number_generator, DataType *random_vector, FlagType *converged, DataType *trace_estimate)</div><div class="ttdoc">For a given random input vector, computes one Monte-Carlo sample to estimate trace using Lanczos quad...</div><div class="ttdef"><b>Definition:</b> <a href="c__trace__estimator_8cpp_source.html#l00401">c_trace_estimator.cpp:401</a></div></div>
<div class="ttc" id="atypes_8h_html_a67de833a333e9264ce27ee3d6e4b2732"><div class="ttname"><a href="types_8h.html#a67de833a333e9264ce27ee3d6e4b2732">FlagType</a></div><div class="ttdeci">int FlagType</div><div class="ttdef"><b>Definition:</b> <a href="types_8h_source.html#l00068">types.h:68</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="c__trace__estimator_8cpp_source.html#l00401">cTraceEstimator&lt; DataType &gt;::_c_stochastic_lanczos_quadrature()</a>, <a class="el" href="convergence__tools_8cpp_source.html#l00256">ConvergenceTools&lt; DataType &gt;::average_estimates()</a>, <a class="el" href="convergence__tools_8cpp_source.html#l00095">ConvergenceTools&lt; DataType &gt;::check_convergence()</a>, <a class="el" href="timer_8cpp_source.html#l00092">Timer::elapsed()</a>, <a class="el" href="c__linear__operator_8cpp_source.html#l00079">cLinearOperator&lt; DataType &gt;::get_num_rows()</a>, <a class="el" href="timer_8cpp_source.html#l00066">Timer::start()</a>, and <a class="el" href="timer_8cpp_source.html#l00079">Timer::stop()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classcTraceEstimator_a29144b4d62c71f0889002754384f57f4_cgraph.png" border="0" usemap="#aclasscTraceEstimator_a29144b4d62c71f0889002754384f57f4_cgraph" alt=""/></div>
<map name="aclasscTraceEstimator_a29144b4d62c71f0889002754384f57f4_cgraph" id="aclasscTraceEstimator_a29144b4d62c71f0889002754384f57f4_cgraph">
<area shape="rect" title="Stochastic Lanczos quadrature method to estimate trace of a function of a linear operator...." alt="" coords="5,1123,147,1165"/>
<area shape="rect" href="classcTraceEstimator.html#a02afa505a915c58380b99a62e4d56b30" title="For a given random input vector, computes one Monte&#45;Carlo sample to estimate trace using Lanczos quad..." alt="" coords="220,748,371,804"/>
<area shape="rect" href="classcLinearOperator.html#aecc5b62db1d8a41f5112b289c7031aaf" title=" " alt="" coords="481,1017,636,1058"/>
<area shape="rect" href="classConvergenceTools.html#a88ae9fc09aa9af950d41cf803934c028" title="Averages the estimates of trace. Removes outliers and reevaluates the error to take into account for ..." alt="" coords="195,1123,396,1165"/>
<area shape="rect" href="classConvergenceTools.html#a5a0602ee4f933a4521ccf9ea137dd191" title="Checks if the standard deviation of the set of the cumulative averages of trace estimators converged ..." alt="" coords="202,1058,389,1099"/>
<area shape="rect" href="classTimer.html#a6a89a613c2af9b0d1e5f7e4ba9e46c54" title="Returns the elapsed time in seconds." alt="" coords="236,1189,355,1216"/>
<area shape="rect" href="classTimer.html#a3a8b5272198d029779dc9302a54305a8" title="Starts the timer." alt="" coords="246,1291,345,1317"/>
<area shape="rect" href="classTimer.html#a63f0eb44b27402196590a03781515dba" title="Stops the timer." alt="" coords="247,1240,343,1267"/>
<area shape="rect" href="c__golub__kahn__bidiagonalization_8cpp.html#a6125b021cd93b43ab4d9f20813487f85" title="Bi&#45;diagonalizes the positive&#45;definite matrix A using Golub&#45;Kahn&#45;Lanczos method." alt="" coords="444,188,673,215"/>
<area shape="rect" href="c__lanczos__tridiagonalization_8cpp.html#a88831f1a1ba564b198f446a7c8a8d5ef" title="Tri&#45;diagonalizes matrix A to T using the start vector v. is the Lanczos degree, which will be the siz..." alt="" coords="455,428,662,455"/>
<area shape="rect" href="classDiagonalization.html#a18924365b0d74983ead3901886d51204" title="Computes all eigenvalues and eigenvectors of a real and symmetric tridiagonal matrix." alt="" coords="479,559,639,601"/>
<area shape="rect" href="classRandomArrayGenerator.html#a3a577526f391d531fe4d66bdfa0107db" title="Generates a pseudo&#45;random array with Rademacher distribution where elements are either +1 or &#45;1." alt="" coords="465,625,652,666"/>
<area shape="rect" href="classcLinearOperator.html#a0dd6306a434563e4a48a806b43f23d03" title=" " alt="" coords="481,690,636,731"/>
<area shape="rect" href="classcLinearOperator.html#af9be60b44a47eed5b2c98f077ff54987" title=" " alt="" coords="481,755,636,797"/>
<area shape="rect" href="classcLinearOperator.html#af0c980ca87c2795e0dbfda1c84f74591" title="Returns a flag that determines whether a relation between the parameters of the operator and its eige..." alt="" coords="455,821,663,862"/>
<area shape="rect" href="classcLinearOperator.html#ad7395bd04ec8014c9dd0e66c318ae125" title="Sets the scalar parameter this&#45;&gt;parameters. Parameter is initialized to NULL. However,..." alt="" coords="481,886,636,927"/>
<area shape="rect" href="classDiagonalization.html#a636b5e32ca7211d60dadc62b2258b8ea" title="Computes all singular&#45;values and left and right eigenvectors of a real and symmetric upper bi&#45;diagona..." alt="" coords="481,951,636,993"/>
<area shape="rect" href="classcLinearOperator.html#a48c76860a74f00fefaa1297368d17a77" title=" " alt="" coords="757,239,912,265"/>
<area shape="rect" href="classcOrthogonalization.html#a1b1bcbb636f1a1608ce7a22d4538b3b3" title="Modified Gram&#45;Schmidt orthogonalization process to orthogonalize the vector v against a subset of the..." alt="" coords="745,391,925,433"/>
<area shape="rect" href="classcVectorOperations.html#a9bd28bd08f5a6b096d99a4a2f7d23e90" title="Subtracts the scaled input vector from the output vector." alt="" coords="996,391,1168,433"/>
<area shape="rect" href="classcVectorOperations.html#aeb0171f2644e3036907bbbddf47ce998" title="Normalizes a vector based on Euclidean 2&#45;norm. The result is written into another vector." alt="" coords="733,122,937,163"/>
<area shape="rect" href="classcVectorOperations.html#ab0991d74cadf3a3969f0723dbff55dc9" title="Normalizes a vector based on Euclidean 2&#45;norm. The result is written in&#45;place." alt="" coords="737,57,933,98"/>
<area shape="rect" href="classcLinearOperator.html#a40f5051c4399ebfa153ef7147e10a6e6" title=" " alt="" coords="721,5,948,32"/>
<area shape="rect" href="classcVectorOperations.html#abd0d2c941f9d3598f42026755cbc4709" title="Computes the Euclidean norm of a 1D array." alt="" coords="1007,157,1157,198"/>
<area shape="rect" href="classcVectorOperations.html#ab8b945baba573b4479e8095ca87f8b3f" title="Computes Euclidean inner product of two vectors." alt="" coords="1007,479,1157,521"/>
<area shape="rect" href="classcVectorOperations.html#a6627fe95659faa224dca2af1dab1fab3" title="Scales a vector and stores to a new vector." alt="" coords="1007,257,1157,298"/>
<area shape="rect" href="classcVectorOperations.html#a492894cdc368a4f60b28aa15109cf9bc" title="Copies a vector to a new vector. Result is written in&#45;place." alt="" coords="760,559,909,601"/>
<area shape="rect" href="lapack__api_8h.html#a829a495cf9df4ce926be95ee1c6163a8" title=" " alt="" coords="781,625,889,652"/>
<area shape="rect" href="classRandomNumberGenerator.html#a91d8b9726bda7dcd40f9b992b2a1bccd" title="Generates the next random number in the sequence, depending on the thread id." alt="" coords="738,677,931,718"/>
<area shape="rect" href="classXoshiro256StarStar.html#a6a99f74d2ed5f6e3667d785c46bf9569" title="Generates the next presudo&#45;random number." alt="" coords="1009,677,1155,718"/>
<area shape="rect" href="classXoshiro256StarStar.html#a3b10c22cbac4ff9bf4447e28e57f7a72" title="Rotates the bits of a 64 bit integer toward left." alt="" coords="1216,677,1363,718"/>
<area shape="rect" href="lapack__api_8h.html#a14ad2b140c825a35e626fadf98fe495b" title=" " alt="" coords="775,959,894,985"/>
<area shape="rect" href="special__functions_8cpp.html#a44303dd28715725483ae9bb6e214fc17" title="Inverse error function." alt="" coords="525,1115,592,1141"/>
<area shape="rect" href="special__functions_8cpp.html#a8df1c56975179584e0485c5ddcb1e71b" title="sign function." alt="" coords="810,1115,859,1141"/>
<area shape="rect" href="classTimer.html#a46df9c79ce115f9d206c92abcd5969f4" title="Returns the wall time since the epoch." alt="" coords="479,1265,639,1292"/>
</map>
</div>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/runner/work/imate/imate/imate/_c_trace_estimator/<a class="el" href="c__trace__estimator_8h_source.html">c_trace_estimator.h</a></li>
<li>/home/runner/work/imate/imate/imate/_c_trace_estimator/<a class="el" href="c__trace__estimator_8cpp_source.html">c_trace_estimator.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classcTraceEstimator.html">cTraceEstimator</a></li>
    <li class="footer">Generated on Thu Sep 14 2023 04:13:47 for imate by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
