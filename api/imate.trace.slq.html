


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>imate.trace(method=’slq’) &#8212; imate Manual</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=9b1a4fa89bdd0e95b23b" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom-pydata.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/toggleprompt.js"></script>
    <script src="../_static/js/custom-pydata.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api/imate.trace.slq';</script>
    <link rel="shortcut icon" href="../_static/logo-imate.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="imate.schatten" href="../generated/imate.schatten.html" />
    <link rel="prev" title="imate.trace(method=’eigenvalue’)" href="imate.trace.eigenvalue.html" />
    <script defer data-domain="docs.scipy.org" src="https://views.scientific-python.org/js/script.js"></script>

    <!-- Adobe Embed API -->
    <script src="https://documentcloud.adobe.com/view-sdk/viewer.js"></script>

    <!-- My custom JS -->
    <script type="text/javascript" src="../_static/js/custom-pydata.js"></script>

    <!-- Syntax highlighting for BibTex code blocks -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-solarizedlight.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs-bibtex@2.0.1/prism-bibtex.min.js"></script>

    
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">

  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="auto">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fas fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../index.html">

  
  
  
  
  
  
  

  
    <img src="../_static/images/icons/logo-imate-light.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/images/icons/logo-imate-dark.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../tutorials/install.html">
                        Install
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../tutorials/docker.html">
                        Using imate on Docker
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../tutorials/gpu.html">
                        Using GPU Devices
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="../api.html">
                        API Reference
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../cite.html">
                        Publications
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://github.com/ameli/imate" title="GitHub" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://pypi.org/project/imate/" title="PyPI" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-python"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://anaconda.org/s-ameli/imate" title="Anaconda Cloud" class="nav-link" rel="noopener" target="_blank"><span><i class="fa fa-circle-notch"></i></span>
            <label class="sr-only">Anaconda Cloud</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://hub.docker.com/repository/docker/sameli/imate" title="Docker Hub" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-docker"></i></span>
            <label class="sr-only">Docker Hub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://mybinder.org/v2/gh/ameli/imate/HEAD?filepath=notebooks%2FInterpolateTraceOfInverse.ipynb" title="Lanuch Jupyter on Binder" class="nav-link" rel="noopener" target="_blank"><span><i class="fa fa-chart-line"></i></span>
            <label class="sr-only">Lanuch Jupyter on Binder</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search">
  <i class="fas fa-search"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fas fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../tutorials/install.html">
                        Install
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../tutorials/docker.html">
                        Using imate on Docker
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../tutorials/gpu.html">
                        Using GPU Devices
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="../api.html">
                        API Reference
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../cite.html">
                        Publications
                    </a>
                </li>
                
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://github.com/ameli/imate" title="GitHub" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://pypi.org/project/imate/" title="PyPI" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-python"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://anaconda.org/s-ameli/imate" title="Anaconda Cloud" class="nav-link" rel="noopener" target="_blank"><span><i class="fa fa-circle-notch"></i></span>
            <label class="sr-only">Anaconda Cloud</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://hub.docker.com/repository/docker/sameli/imate" title="Docker Hub" class="nav-link" rel="noopener" target="_blank"><span><i class="fab fa-docker"></i></span>
            <label class="sr-only">Docker Hub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          <a href="https://mybinder.org/v2/gh/ameli/imate/HEAD?filepath=notebooks%2FInterpolateTraceOfInverse.ipynb" title="Lanuch Jupyter on Binder" class="nav-link" rel="noopener" target="_blank"><span><i class="fa fa-chart-line"></i></span>
            <label class="sr-only">Lanuch Jupyter on Binder</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
    None
    
  </div>
</nav>
    </div>
    <div class="sidebar-start-items__item">
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  <section id="imate-trace-method-slq">
<span id="imate-trace-slq"></span><h1>imate.trace(method=’slq’)<a class="headerlink" href="#imate-trace-method-slq" title="Permalink to this heading">#</a></h1>
<dl class="custom-domain function">
<dt class="sig sig-object custom-domain">
<span class="sig-prename descclassname"><span class="pre">imate.</span></span><span class="sig-name descname"><span class="pre">trace</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gram</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_info</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'slq'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_num_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_num_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_atol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_rtol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">confidence_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outlier_significance_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lanczos_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lanczos_tol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orthogonalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_threads</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_gpu_devices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span></dt>
<dd><blockquote>
<div><div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>This page describes only the <cite>slq</cite> method. For other
methods, see <a class="reference internal" href="../generated/imate.trace.html#imate.trace" title="imate.trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">imate.trace()</span></code></a>.</p>
</div>
</div></blockquote>
<p>Trace of matrix or linear operator using stochastic Lanczos quadrature
method.</p>
<p>Given the matrix or the linear operator <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> and the real
non-negative exponent <span class="math notranslate nohighlight">\(p \geq 0\)</span>, the following is computed:</p>
<div class="math notranslate nohighlight">
\[\mathrm{trace} \left(\mathbf{A}^p \right).\]</div>
<p>If <code class="docutils literal notranslate"><span class="pre">gram</span></code> is <cite>True</cite>, then <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> in the above is replaced by
the Gramian matrix <span class="math notranslate nohighlight">\(\mathbf{A}^{\intercal} \mathbf{A}\)</span>, and the
following is instead computed:</p>
<div class="math notranslate nohighlight">
\[\mathrm{trace} \left((\mathbf{A}^{\intercal}\mathbf{A})^p
\right).\]</div>
<p>If <span class="math notranslate nohighlight">\(\mathbf{A} = \mathbf{A}(t)\)</span> is a linear operator of the class
<a class="reference internal" href="../generated/imate.AffineMatrixFunction.html#imate.AffineMatrixFunction" title="imate.AffineMatrixFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">imate.AffineMatrixFunction</span></code></a> with the parameter <span class="math notranslate nohighlight">\(t\)</span>, then for
an input  tuple <span class="math notranslate nohighlight">\(t = (t_1, \dots, t_q)\)</span>, an array output of the
size <span class="math notranslate nohighlight">\(q\)</span> is returned, namely:</p>
<div class="math notranslate nohighlight">
\[\mathrm{trace} \left((\mathbf{A}(t_i))^p \right),
\quad i=1, \dots, q.\]</div>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>A</strong><span class="classifier">numpy.ndarray, scipy.sparse, <a class="reference internal" href="../generated/imate.Matrix.html#imate.Matrix" title="imate.Matrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">imate.Matrix</span></code></a>, or             <a class="reference internal" href="../generated/imate.AffineMatrixFunction.html#imate.AffineMatrixFunction" title="imate.AffineMatrixFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">imate.AffineMatrixFunction</span></code></a></span></dt><dd><p>A sparse or dense matrix or linear operator. If <code class="docutils literal notranslate"><span class="pre">gram</span></code> is <cite>False</cite>,
then <cite>A</cite> should be symmetric.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The symmetry of <cite>A</cite> is not pre-checked by this function. If
<code class="docutils literal notranslate"><span class="pre">gram</span></code> is <cite>False</cite>, make sure <cite>A</cite> is symmetric.</p>
</div>
</dd>
<dt><strong>gram</strong><span class="classifier">bool, default=False</span></dt><dd><p>If <cite>True</cite>, the trace of the Gramian matrix,
<span class="math notranslate nohighlight">\((\mathbf{A}^{\intercal}\mathbf{A})^p\)</span>, is computed. The
Gramian matrix itself is not directly computed. If <cite>False</cite>, the
trace of <span class="math notranslate nohighlight">\(\mathbf{A}^p\)</span> is computed.</p>
</dd>
<dt><strong>p</strong><span class="classifier">float, default=1.0</span></dt><dd><p>The non-negative real exponent <span class="math notranslate nohighlight">\(p\)</span> in <span class="math notranslate nohighlight">\(\mathbf{A}^p\)</span>.</p>
</dd>
<dt><strong>return_info</strong><span class="classifier">bool, default=False</span></dt><dd><p>If <cite>True</cite>, this function also returns a dictionary containing
information about the inner computation, such as process time,
algorithm settings, etc.</p>
</dd>
<dt><strong>parameters</strong><span class="classifier">array_like [<cite>float</cite>], default=one</span></dt><dd><p>This argument is relevant if <cite>A</cite> is a type of
<a class="reference internal" href="../generated/imate.AffineMatrixFunction.html#imate.AffineMatrixFunction" title="imate.AffineMatrixFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">AffineMatrixFunction</span></code></a>. By this argument, multiple inquiries,
<span class="math notranslate nohighlight">\((t_1, \dots, t_q)\)</span>, can be passed to the parameter <span class="math notranslate nohighlight">\(t\)</span> of
the linear operator <span class="math notranslate nohighlight">\(\mathbf{A}(t)\)</span>. The output of this function
becomes an array of the size <span class="math notranslate nohighlight">\(q\)</span> corresponding to each of the
input matrices <span class="math notranslate nohighlight">\(\mathbf{A}(t_i)\)</span>.</p>
</dd>
<dt><strong>min_num_samples</strong><span class="classifier">int, default=10</span></dt><dd><p>The minimum number of Monte-Carlo samples. If the convergence criterion
is reached before finishing the minimum number of iterations, the
iterations are forced to continue till the minimum number of iterations
is finished. This value should be smaller than
<code class="docutils literal notranslate"><span class="pre">maximum_num_samples</span></code>.</p>
</dd>
<dt><strong>max_num_samples</strong><span class="classifier">int, default=50</span></dt><dd><p>The maximum number of Monte-Carlo samples. If the convergence criterion
is not reached by the maximum number of iterations, the iterations are
forced to stop. This value should be larger than
<code class="docutils literal notranslate"><span class="pre">minimum_num_samples</span></code>.</p>
</dd>
<dt><strong>error_atol</strong><span class="classifier">float, default=None</span></dt><dd><p>Tolerance of the absolute error of convergence of the output. Once the
error of convergence reaches <code class="docutils literal notranslate"><span class="pre">error_atol</span> <span class="pre">+</span> <span class="pre">error_rtol</span> <span class="pre">*</span> <span class="pre">output</span></code>, the
iteration is terminated. If the convergence criterion is not met by the
tolerance, then the iterations continue till reaching
<code class="docutils literal notranslate"><span class="pre">max_num_samples</span></code> iterations. If <cite>None</cite>, the termination criterion
does not depend on this parameter.</p>
</dd>
<dt><strong>error_rtol</strong><span class="classifier">float, default=None</span></dt><dd><p>Tolerance of the relative error of convergence of the output. Once the
error of convergence reaches <code class="docutils literal notranslate"><span class="pre">error_atol</span> <span class="pre">+</span> <span class="pre">error_rtol</span> <span class="pre">*</span> <span class="pre">output</span></code>, the
iteration is terminated. If the convergence criterion is not met by the
tolerance, then the iterations continue till reaching
<code class="docutils literal notranslate"><span class="pre">max_num_samples</span></code> iterations. If <cite>None</cite>, the termination criterion
does not depend on this parameter.</p>
</dd>
<dt><strong>confidence_level</strong><span class="classifier">float, default=0.95</span></dt><dd><p>Confidence level of error, which is a number between <cite>0</cite> and <cite>1</cite>. The
error of convergence of the population of samples is defined by their
standard deviation times the Z-score, which depends on the confidence
level. See notes below for details.</p>
</dd>
<dt><strong>outlier_significance_level</strong><span class="classifier">float, default=0.001</span></dt><dd><p>One minus the confidence level of the uncertainty of the outliers of
the output samples. This is a number between <cite>0</cite> and <cite>1</cite>.</p>
</dd>
<dt><strong>lanczos_degree</strong><span class="classifier">int, default=20</span></dt><dd><p>The number of Lanczos recursive iterations. The larger Lanczos degree
leads to better estimation. The computational cost quadratically
increases with the Lanczos degree.</p>
</dd>
<dt><strong>lanczos_tol</strong><span class="classifier">float, default=None</span></dt><dd><p>The tolerance to stop the Lanczos recursive iterations before
the end of iterations reached. If the tolerance is not met, all the
iterations (total of <code class="docutils literal notranslate"><span class="pre">lanczos_degree</span></code> iterations) continue till the
end. If set to <cite>None</cite> (default value), the machine’ epsilon precision
is used. The machine’s epsilon precision is as follows:</p>
<ul class="simple">
<li><p>For 32-bit, machine precision is
<span class="math notranslate nohighlight">\(2^{-23} = 1.1920929 \times 10^{-7}\)</span>.</p></li>
<li><p>For 64-bit, machine precision is
<span class="math notranslate nohighlight">\(2^{-52} = 2.220446049250313 \times 10^{-16}\)</span>,</p></li>
<li><p>For 128-bit, machine precision is
<span class="math notranslate nohighlight">\(2^{-63} = -1.084202172485504434 \times 10^{-19}\)</span>.</p></li>
</ul>
</dd>
<dt><strong>orthogonalize</strong><span class="classifier">int, default=0</span></dt><dd><p>Indicates whether to re-orthogonalize the eigenvectors during Lanczos
recursive iterations.</p>
<ul class="simple">
<li><p>If set to <cite>0</cite>, no orthogonalization is performed.</p></li>
<li><p>If set to a negative integer or an integer larger than
<code class="docutils literal notranslate"><span class="pre">lanczos_degree</span></code>, a newly computed eigenvector is orthogonalized
against all the previous eigenvectors (also known as
<cite>full reorthogonalization</cite>).</p></li>
<li><p>If set to a positive integer, say <cite>q</cite>, but less than
<code class="docutils literal notranslate"><span class="pre">lanczos_degree</span></code>, the newly computed eigenvector is
orthogonalized against a window of last <cite>q</cite> previous eigenvectors
(known as <cite>partial reorthogonalization</cite>).</p></li>
</ul>
</dd>
<dt><strong>num_threads</strong><span class="classifier">int, default=0</span></dt><dd><p>Number of processor threads to employ for parallel computation on CPU.
If set to <cite>0</cite> or a number larger than the available number of threads,
all threads of the processor are used. The parallelization is performed
over the Monte-Carlo iterations.</p>
</dd>
<dt><strong>num_gpu_devices</strong><span class="classifier">int default=0</span></dt><dd><p>Number of GPU devices (if available) to use for parallel multi-GPU
processing. If set to <cite>0</cite>, the maximum number of available GPU devices
is used. This parameter is relevant if <code class="docutils literal notranslate"><span class="pre">gpu</span></code> is <cite>True</cite>.</p>
</dd>
<dt><strong>gpu</strong><span class="classifier">bool, default=False</span></dt><dd><p>If <cite>True</cite>, the computations are performed on GPU devices where the
number of devices can be set by <code class="docutils literal notranslate"><span class="pre">num_gpu_devices</span></code>. If no GPU device
is found, it raises an error.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When performing <cite>repetitive</cite> computation on the same matrix on GPU,
it is recommended to input <cite>A</cite> as an instance of
<a class="reference internal" href="../generated/imate.Matrix.html#imate.Matrix" title="imate.Matrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">imate.Matrix</span></code></a> class instead of <cite>numpy</cite> or <cite>scipy</cite> matrices.
See examples below for clarification.</p>
</div>
</dd>
<dt><strong>verbose</strong><span class="classifier">bool, default=False</span></dt><dd><p>Prints extra information about the computations.</p>
</dd>
<dt><strong>plot</strong><span class="classifier">bool, default=False</span></dt><dd><p>Plots convergence of samples. For this, the packages <cite>matplotlib</cite> and
<cite>seaborn</cite> should be installed. If no display is available (such as
running this code on remote machines), the plots are saved as an <cite>SVG</cite>
file in the current directory.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><strong>Trace</strong><span class="classifier">float or numpy.array</span></dt><dd><p>Trace of matrix. If <cite>A</cite> is of type
<a class="reference internal" href="../generated/imate.AffineMatrixFunction.html#imate.AffineMatrixFunction" title="imate.AffineMatrixFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">imate.AffineMatrixFunction</span></code></a> with an array of <code class="docutils literal notranslate"><span class="pre">parameters</span></code>,
then the output is an array.</p>
</dd>
<dt><strong>info</strong><span class="classifier">dict</span></dt><dd><p>(Only if <code class="docutils literal notranslate"><span class="pre">return_info</span></code> is <cite>True</cite>) A dictionary of information with
the following.</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">matrix</span></code>:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">data_type</span></code>: <cite>str</cite>, {<cite>float32</cite>, <cite>float64</cite>, <cite>float128</cite>}. Type of
the matrix data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gram</span></code>: <cite>bool</cite>, whether the matrix <cite>A</cite> or its Gramian is
considered.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exponent</span></code>: <cite>float</cite>, the exponent <cite>p</cite> in <span class="math notranslate nohighlight">\(\mathbf{A}^p\)</span>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">size</span></code>: (int) The size of matrix <cite>A</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sparse</span></code>: <cite>bool</cite>, whether the matrix <cite>A</cite> is sparse or dense.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nnz</span></code>: <cite>int</cite>, if <cite>A</cite> is sparse, the number of non-zero elements
of <cite>A</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">density</span></code>: <cite>float</cite>, if <cite>A</cite> is sparse, the density of <cite>A</cite>, which
is the <cite>nnz</cite> divided by size squared.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_inquiries</span></code>: <cite>int</cite>, the size of inquiries of each parameter
of the linear operator <cite>A</cite>. If <cite>A</cite> is a matrix, this is always
<cite>1</cite>. If <cite>A</cite> is a type of <a class="reference internal" href="../generated/imate.AffineMatrixFunction.html#imate.AffineMatrixFunction" title="imate.AffineMatrixFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">AffineMatrixFunction</span></code></a>, this
value is the number of <span class="math notranslate nohighlight">\(t_i\)</span> parameters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_operator_parameters</span></code>: <cite>int</cite>, number of parameters of the
operator <cite>A</cite>. If <cite>A</cite> a type of <a class="reference internal" href="../generated/imate.AffineMatrixFunction.html#imate.AffineMatrixFunction" title="imate.AffineMatrixFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">AffineMatrixFunction</span></code></a>,
then this value is <cite>1</cite> corresponding to one parameter <span class="math notranslate nohighlight">\(t\)</span>
in the affine function <cite>t mapsto mathbf{A} + t mathbf{B}</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parameters</span></code>: <cite>list</cite> [<cite>float</cite>], the parameters of the linear
operator <cite>A</cite>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">convergence</span></code>:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">all_converged</span></code>: <cite>bool</cite>, whether the Monte-Carlo sampling
converged for all requested parameters <span class="math notranslate nohighlight">\(t_i\)</span>. If all
entries of the array for <code class="docutils literal notranslate"><span class="pre">converged</span></code> is <cite>True`</cite>, then this
value is also <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">converged</span></code>: <cite>array</cite> [<cite>bool</cite>], whether the Monte-Carlo sampling
converged for each of the requested parameters <span class="math notranslate nohighlight">\(t_i\)</span>.
Convergence is defined based on a termination criterion, such
as absolute or relative error. If the iterations terminated due
to reaching the maximum number of samples, this value is <cite>False</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_num_samples</span></code>: <cite>int</cite>, the minimum number of Monte-Carlo
iterations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_num_samples</span></code>: <cite>int</cite>, the maximum number of Monte-Carlo
iterations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_outliers</span></code>: <cite>int</cite>, number of outliers found during search
for outliers among the array of output.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_samples_used</span></code>: <cite>int</cite>, number of Monte-Carlo samples used
to produce the output. This is the total number of iterations
minus the number of outliers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">samples</span></code>: <cite>array</cite> [<cite>float</cite>], an array of the size
<cite>max_num_samples</cite>. The first few entries (<cite>num_samples_used</cite>) of
this array are the output results of the Monte-Carlo sampling.
The average of these samples is the final result. The rest of
this array is <cite>nan</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">samples_mean</span></code>: <cite>float</cite>, mean of the <cite>samples</cite> array, excluding
the <cite>nan</cite> values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">samples_processed_order</span></code>: <cite>array</cite> [<cite>int</cite>], in parallel
processing, samples are processed in non-sequential order. This
array, which has the same size as <cite>samples</cite>, keeps track of the
order in which each sample is processed.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">error</span></code>:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">absolute_error</span></code>: <cite>float</cite>, the absolute error of the
convergence of samples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">confidence_level</span></code>: <cite>float</cite>, the confidence level used to
calculate the error from standard deviation of samples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_atol</span></code>: <cite>float</cite>, the tolerance of absolute error of the
convergence of samples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_rtol</span></code>: <cite>float</cite>, the tolerance of relative error of the
convergence of samples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outlier_significance_level</span></code>: <cite>float</cite>, the significance level
used to determine the outliers in samples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">relative_error</span></code>: <cite>float</cite>, the relative error of the
convergence of samples.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">device</span></code>:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">num_cpu_threads</span></code>: <cite>int</cite>, number of CPU threads used in shared
memory parallel processing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_gpu_devices</span></code>: <cite>int</cite>, number of GPU devices used in the
multi-GPU (GPU farm) computation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_gpu_multiprocessors</span></code>: <cite>int</cite>, number of GPU
multi-processors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_gpu_threads_per_multiprocessor</span></code>: <cite>int</cite>, number of GPU
threads on each GPU multi-processor.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">time</span></code>:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">tot_wall_time</span></code>: <cite>float</cite>, total elapsed time of computation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alg_wall_time</span></code>: <cite>float</cite>, elapsed time of computation during
only the algorithm execution.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cpu_proc_time</span></code>: <cite>float</cite>, the CPU processing time of
computation.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">solver</span></code>:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">version</span></code>: <cite>str</cite>, version of imate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method</span></code>: ‘slq’.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lanczos_degree</span></code>: <cite>bool</cite>, Lanczos degree.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lanczos_tol</span></code>: <cite>float</cite>, Lanczos tolerance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orthogonalize</span></code>: <cite>int</cite>, orthogonalization flag.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><dl class="simple">
<dt>ImportError</dt><dd><p>If the package has not been compiled with GPU support, but <code class="docutils literal notranslate"><span class="pre">gpu</span></code> is
set to <cite>True</cite>. To resolve the issue, set <code class="docutils literal notranslate"><span class="pre">gpu</span></code> to <cite>False</cite> to be able
to use the existing installation. Alternatively,  export the
environment variable <code class="docutils literal notranslate"><span class="pre">USE_CUDA=1</span></code> and recompile the source code of
the package.</p>
</dd>
</dl>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="../generated/imate.logdet.html#imate.logdet" title="imate.logdet"><code class="xref py py-obj docutils literal notranslate"><span class="pre">imate.logdet</span></code></a></dt><dd></dd>
<dt><a class="reference internal" href="../generated/imate.traceinv.html#imate.traceinv" title="imate.traceinv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">imate.traceinv</span></code></a></dt><dd></dd>
<dt><a class="reference internal" href="../generated/imate.schatten.html#imate.schatten" title="imate.schatten"><code class="xref py py-obj docutils literal notranslate"><span class="pre">imate.schatten</span></code></a></dt><dd></dd>
</dl>
</div>
<p class="rubric">Notes</p>
<p><strong>Computational Complexity:</strong></p>
<p>This method uses stochastic Lanczos quadrature (SLQ), which is a randomized
algorithm. The computational complexity of this method is</p>
<div class="math notranslate nohighlight">
\[\mathcal{O}((\rho n^2 + n l) s l),\]</div>
<p>where <span class="math notranslate nohighlight">\(n\)</span> is the matrix size, <span class="math notranslate nohighlight">\(\rho\)</span> is the density of
sparse matrix (for dense matrix, <span class="math notranslate nohighlight">\(\rho=1\)</span>), <span class="math notranslate nohighlight">\(l\)</span> is the
Lanczos degree (set with <code class="docutils literal notranslate"><span class="pre">lanczos_degree</span></code>), and <span class="math notranslate nohighlight">\(s\)</span> is the number
of samples (set with <code class="docutils literal notranslate"><span class="pre">min_num_samples</span></code> and <code class="docutils literal notranslate"><span class="pre">max_num_samples</span></code>).</p>
<p>This method can be used on very large matrices (<span class="math notranslate nohighlight">\(n &gt; 2^{12}\)</span>). The
solution is an approximation.</p>
<p><strong>Input Matrix:</strong></p>
<p>The input <cite>A</cite> can be either of:</p>
<ul class="simple">
<li><p>A matrix, such as <cite>numpy.ndarray</cite>, or <cite>scipy.sparse</cite>.</p></li>
<li><p>A linear operator representing a matrix using <a class="reference internal" href="../generated/imate.Matrix.html#imate.Matrix" title="imate.Matrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">imate.Matrix</span></code></a>.</p></li>
<li><p>A linear operator representing a one-parameter family of an affine matrix
function <span class="math notranslate nohighlight">\(t \mapsto \mathbf{A} + t\mathbf{B}\)</span> using
<a class="reference internal" href="../generated/imate.AffineMatrixFunction.html#imate.AffineMatrixFunction" title="imate.AffineMatrixFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">imate.AffineMatrixFunction</span></code></a>.</p></li>
</ul>
<p><strong>Output:</strong></p>
<p>The output is a scalar. However, if <cite>A</cite> is the linear operator
<span class="math notranslate nohighlight">\(\mathbf{A}(t) = \mathbf{A} + t \mathbf{B}\)</span> where <span class="math notranslate nohighlight">\(t\)</span> is
given as the tuple <span class="math notranslate nohighlight">\(t = (t_1, \dots, t_q)\)</span>, then the output of this
function is an array of size <span class="math notranslate nohighlight">\(q\)</span> corresponding to the
trace of each <span class="math notranslate nohighlight">\(\mathbf{A}(t_i)\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When <cite>A</cite> represents
<span class="math notranslate nohighlight">\(\mathbf{A}(t) = \mathbf{A} + t \mathbf{I}\)</span>, where
<span class="math notranslate nohighlight">\(\mathbf{I}\)</span> is the identity matrix, and <span class="math notranslate nohighlight">\(t\)</span> is given by
a tuple <span class="math notranslate nohighlight">\(t = (t_1, \dots, t_q)\)</span>, the computational cost of an
array output of size <cite>q</cite> is the same as computing for a single
<span class="math notranslate nohighlight">\(t_i\)</span>. Namely, the trace of only <span class="math notranslate nohighlight">\(\mathbf{A}(t_1)\)</span> is
computed, and the trace of the rest of <span class="math notranslate nohighlight">\(i=2, \dots, q\)</span> are
obtained from the result of <span class="math notranslate nohighlight">\(t_1\)</span> immediately.</p>
</div>
<p><strong>Algorithm:</strong></p>
<p>If <code class="docutils literal notranslate"><span class="pre">gram</span></code> is <cite>False</cite>, the Lanczos tri-diagonalization method is
used. This method requires only matrix-vector multiplication. If
<code class="docutils literal notranslate"><span class="pre">gram</span></code> is <cite>True</cite>, the Golub-Kahn bi-diagonalization method is used. This
method requires both matrix-vector multiplication and transposed-matrix
vector multiplications.</p>
<p><strong>Convergence criterion:</strong></p>
<p>Let <span class="math notranslate nohighlight">\(n_{\min}\)</span> and <span class="math notranslate nohighlight">\(n_{\max}\)</span> be the minimum and maximum
number of iterations respectively defined by <code class="docutils literal notranslate"><span class="pre">min_num_samples</span></code> and
<code class="docutils literal notranslate"><span class="pre">max_num_samples</span></code>. The iterations terminate at
<span class="math notranslate nohighlight">\(n_{\min} \leq i \leq n_{\max}\)</span> where <span class="math notranslate nohighlight">\(i\)</span> is the
iteration counter. The iterations stop earlier at <span class="math notranslate nohighlight">\(i &lt; n_{\max}\)</span> if
the convergence error of the mean of the samples is satisfied, as follows.</p>
<p>Suppose <span class="math notranslate nohighlight">\(s(j)\)</span> and <span class="math notranslate nohighlight">\(\sigma(i)\)</span> are respectively the mean and
standard deviation of samples after <span class="math notranslate nohighlight">\(j\)</span> iterations. The error of
convergence, <span class="math notranslate nohighlight">\(e(j)\)</span>, is defined by</p>
<div class="math notranslate nohighlight">
\[e(j) = \frac{\sigma(j)}{\sqrt{j}} Z\]</div>
<p>where <span class="math notranslate nohighlight">\(Z\)</span> is the Z-score defined by</p>
<div class="math notranslate nohighlight">
\[Z = \sqrt{2} \mathrm{erf}^{-1}(\phi).\]</div>
<p>In the above, <span class="math notranslate nohighlight">\(\phi\)</span> is the confidence level and set by
<code class="docutils literal notranslate"><span class="pre">confidence_level</span></code> argument, and <span class="math notranslate nohighlight">\(\mathrm{erf}^{-1}\)</span> is the
inverse error function. A confidence level of 95%, for instance, means that
the Z-score is 1.96, which means the confidence interval is
<span class="math notranslate nohighlight">\(\pm 1.96 \sigma\)</span>.</p>
<p>The termination criterion is</p>
<div class="math notranslate nohighlight">
\[e(j) &lt; \epsilon_a + s(j) \epsilon_r,\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon_{a}\)</span> and <span class="math notranslate nohighlight">\(\epsilon_r\)</span> are the absolute and
relative error tolerances respectively, and they are set by <code class="docutils literal notranslate"><span class="pre">error_atol</span></code>
and <code class="docutils literal notranslate"><span class="pre">error_rtol</span></code>.</p>
<p><strong>Convergence for the case of multiple parameters:</strong></p>
<p>When <cite>A</cite> is a type of <a class="reference internal" href="../generated/imate.AffineMatrixFunction.html#imate.AffineMatrixFunction" title="imate.AffineMatrixFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">imate.AffineMatrixFunction</span></code></a> representing the
affine matrix function <span class="math notranslate nohighlight">\(\mathbf{A}(t) = \mathbf{A} + t \mathbf{B}\)</span>
and if multiple parameters <span class="math notranslate nohighlight">\(t_i\)</span>, <span class="math notranslate nohighlight">\(i=1,\dots, q\)</span> are passed to
this function through <code class="docutils literal notranslate"><span class="pre">parameters</span></code> argument, the convergence criterion
has to be satisfied for each of <span class="math notranslate nohighlight">\(\mathbf{A}(t_i)\)</span>. Specifically, the
iterations are terminated as follows:</p>
<ul class="simple">
<li><p>If <span class="math notranslate nohighlight">\(\mathbf{B}\)</span> is the identity matrix, iterations for all
<span class="math notranslate nohighlight">\(\mathbf{A}(t_i)\)</span> continue till the convergence criterion for
<em>all</em> <span class="math notranslate nohighlight">\(t_i\)</span> are satisfied. That is, even if <span class="math notranslate nohighlight">\(t=t_i\)</span> is
converged but <span class="math notranslate nohighlight">\(t=t_j\)</span> has not converged yet, the iterations for
<span class="math notranslate nohighlight">\(t=t_i\)</span> will continue.
:</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\mathbf{B}\)</span> is not the identity matrix, the iterations for
each of <span class="math notranslate nohighlight">\(t_i\)</span> are independent. That is, if <span class="math notranslate nohighlight">\(t=t_i\)</span> converges,
the iterations for that parameter will stop regardless of the convergence
status of other parameters.</p></li>
</ul>
<p><strong>Plotting:</strong></p>
<p>If <code class="docutils literal notranslate"><span class="pre">plot</span></code> is set to <cite>True</cite>, it plots the convergence of samples and their
relative error.</p>
<ul class="simple">
<li><p>If no graphical backend exists (such as running the code on a remote
server or manually disabling the X11 backend), the plot will not be
shown, rather, it will be saved as an <code class="docutils literal notranslate"><span class="pre">svg</span></code> file in the current
directory.</p></li>
<li><p>If the executable <code class="docutils literal notranslate"><span class="pre">latex</span></code> is available on <code class="docutils literal notranslate"><span class="pre">PATH</span></code>, the plot is
rendered using <span class="math notranslate nohighlight">\(\rm\LaTeX\)</span> and it may take slightly longer to
produce the plot.</p></li>
<li><p>If <span class="math notranslate nohighlight">\(\rm\LaTeX\)</span> is not installed, it uses any available San-Serif
font to render the plot.</p></li>
</ul>
<p>To manually disable interactive plot display and save the plot as
<code class="docutils literal notranslate"><span class="pre">svg</span></code> instead, add the following at the very beginning of your code
before importing <a class="reference internal" href="../index.html#module-imate" title="imate"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imate</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;IMATE_NO_DISPLAY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;True&#39;</span>
</pre></div>
</div>
<p class="rubric">References</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www-users.cs.umn.edu/~saad/PDF/ys-2016-04.pdf">Ubaru, S., Chen, J., and Saad, Y. (2017)</a>,
Fast Estimation of <span class="math notranslate nohighlight">\(\mathrm{tr}(F(A))\)</span> Via Stochastic Lanczos
Quadrature, SIAM J. Matrix Anal. Appl., 38(4), 1075-1099.</p></li>
</ul>
<p class="rubric">Examples</p>
<p><strong>Symmetric Input Matrix:</strong></p>
<p>The <cite>slq</cite> method requires the input matrix of <a class="reference internal" href="../generated/imate.trace.html#imate.trace" title="imate.trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">imate.trace()</span></code></a> function
to be symmetric when <code class="docutils literal notranslate"><span class="pre">gram</span></code> is <cite>False</cite>. For the first example, generate a
symmetric sample matrix using <a class="reference internal" href="../generated/imate.toeplitz.html#imate.toeplitz" title="imate.toeplitz"><code class="xref py py-func docutils literal notranslate"><span class="pre">imate.toeplitz()</span></code></a> function as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Import packages</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">imate</span> <span class="kn">import</span> <span class="n">toeplitz</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generate a symmetric matrix by setting gram=True.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">toeplitz</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">gram</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above, by passing <code class="docutils literal notranslate"><span class="pre">gram=True</span></code> to <a class="reference internal" href="../generated/imate.toeplitz.html#imate.toeplitz" title="imate.toeplitz"><code class="xref py py-func docutils literal notranslate"><span class="pre">imate.toeplitz()</span></code></a> function,
the Gramian of the Toeplitz matrix is returned, which is symmetric. Compute
the trace of <span class="math notranslate nohighlight">\(\mathbf{A}^{2.5}\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Import packages</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">imate</span> <span class="kn">import</span> <span class="n">trace</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute trace</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trace</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">gram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slq&#39;</span><span class="p">)</span>
<span class="go">3177.56</span>
</pre></div>
</div>
<p><strong>Gramian Matrix:</strong></p>
<p>Passing <code class="docutils literal notranslate"><span class="pre">gram=True</span></code> to <a class="reference internal" href="../generated/imate.trace.html#imate.trace" title="imate.trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">imate.trace()</span></code></a> function uses the Gramian
of the input matrix. In this case, the input matrix can be non-symmetric.
In the next example, generate a non-symmetric matrix, <span class="math notranslate nohighlight">\(\mathbf{B}\)</span>,
then compute the trace of
<span class="math notranslate nohighlight">\((\mathbf{B}^{\intercal} \mathbf{B})^{2.5}\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generate a non-symmetric matrix by setting gram=False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span> <span class="o">=</span> <span class="n">toeplitz</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">gram</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute the trace of Gramian by passing gram=True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trace</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">gram</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slq&#39;</span><span class="p">)</span>
<span class="go">3180.60</span>
</pre></div>
</div>
<p>Note that the result of the two examples in the above are the similar since
the input matrix <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> of the first example is the Gramian of
the input matrix <span class="math notranslate nohighlight">\(\mathbf{B}\)</span> in the second example, that is
<span class="math notranslate nohighlight">\(\mathbf{A} = \mathbf{B}^{\intercal} \mathbf{B}\)</span>. Since the
second example uses the Gramian of the input matrix, it computes the same
quantity as the first example.</p>
<p><strong>Verbose output:</strong></p>
<p>By setting <code class="docutils literal notranslate"><span class="pre">verbose</span></code> to <cite>True</cite>, useful info about the process is
printed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tr</span> <span class="o">=</span> <span class="n">trace</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slq&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="go">                                    results</span>
<span class="go">==============================================================================</span>
<span class="go">     inquiries                            error            samples            </span>
<span class="go">--------------------              ---------------------   ---------           </span>
<span class="go">i         parameters       trace    absolute   relative   num   out  converged</span>
<span class="go">==============================================================================</span>
<span class="go">1               none  +4.896e+02   9.186e+00     1.876%    50     0      False</span>

<span class="go">                                    config                                    </span>
<span class="go">==============================================================================</span>
<span class="go">                matrix                            stochastic estimator        </span>
<span class="go">-------------------------------------    -------------------------------------</span>
<span class="go">gram:                           False    method:                           slq</span>
<span class="go">exponent:                           1    lanczos degree:                    20</span>
<span class="go">num matrix parameters:              0    lanczos tol:                2.220e-16</span>
<span class="go">data type:                     64-bit    orthogonalization:               none</span>

<span class="go">             convergence                                 error                </span>
<span class="go">-------------------------------------    -------------------------------------</span>
<span class="go">min num samples:                   10    abs error tol:              0.000e+00</span>
<span class="go">max num samples:                   50    rel error tol:                  1.00%</span>
<span class="go">outlier significance level:     0.00%    confidence level:              95.00%</span>

<span class="go">                                   process                                    </span>
<span class="go">==============================================================================</span>
<span class="go">                 time                                   device                </span>
<span class="go">-------------------------------------    -------------------------------------</span>
<span class="go">tot wall time (sec):        4.183e-03    num cpu threads:                    8</span>
<span class="go">alg wall time (sec):        3.825e-03    num gpu devices, multiproc:     0,  0</span>
<span class="go">cpu proc time (sec):        1.700e-02    num gpu threads per multiproc:      0</span>
</pre></div>
</div>
<p><strong>Output information:</strong></p>
<p>Print information about the inner computation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tr</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">trace</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slq&#39;</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
<span class="go">506.04</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Print dictionary neatly using pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
<span class="go">{</span>
<span class="go">    &#39;convergence&#39;: {</span>
<span class="go">        &#39;all_converged&#39;: False,</span>
<span class="go">        &#39;converged&#39;: False,</span>
<span class="go">        &#39;max_num_samples&#39;: 50,</span>
<span class="go">        &#39;min_num_samples&#39;: 10,</span>
<span class="go">        &#39;num_outliers&#39;: 0,</span>
<span class="go">        &#39;num_samples_used&#39;: 50,</span>
<span class="go">        &#39;samples&#39;: array([527., ..., 495.]),</span>
<span class="go">        &#39;samples_mean&#39;: 506.04,</span>
<span class="go">        &#39;samples_processed_order&#39;: array([ 2, ..., 49])</span>
<span class="go">    },</span>
<span class="go">    &#39;device&#39;: {</span>
<span class="go">        &#39;num_cpu_threads&#39;: 8,</span>
<span class="go">        &#39;num_gpu_devices&#39;: 0,</span>
<span class="go">        &#39;num_gpu_multiprocessors&#39;: 0,</span>
<span class="go">        &#39;num_gpu_threads_per_multiprocessor&#39;: 0</span>
<span class="go">    },</span>
<span class="go">    &#39;error&#39;: {</span>
<span class="go">        &#39;absolute_error&#39;: 10.380366588608128,</span>
<span class="go">       &#39;confidence_level&#39;: 0.95,</span>
<span class="go">       &#39;error_atol&#39;: 0.0,</span>
<span class="go">       &#39;error_rtol&#39;: 0.01,</span>
<span class="go">       &#39;outlier_significance_level&#39;: 0.001,</span>
<span class="go">       &#39;relative_error&#39;: 0.02051293689947065</span>
<span class="go">    },</span>
<span class="go">    &#39;matrix&#39;: {</span>
<span class="go">        &#39;data_type&#39;: b&#39;float64&#39;,</span>
<span class="go">        &#39;density&#39;: 0.0298,</span>
<span class="go">        &#39;exponent&#39;: 1.0,</span>
<span class="go">        &#39;gram&#39;: False,</span>
<span class="go">        &#39;nnz&#39;: 298,</span>
<span class="go">        &#39;num_inquiries&#39;: 1,</span>
<span class="go">        &#39;num_operator_parameters&#39;: 0,</span>
<span class="go">        &#39;parameters&#39;: None,</span>
<span class="go">        &#39;size&#39;: 100,</span>
<span class="go">        &#39;sparse&#39;: True</span>
<span class="go">    },</span>
<span class="go">    &#39;solver&#39;: {</span>
<span class="go">        &#39;lanczos_degree&#39;: 20,</span>
<span class="go">        &#39;lanczos_tol&#39;: 2.220446049250313e-16,</span>
<span class="go">        &#39;method&#39;: &#39;slq&#39;,</span>
<span class="go">        &#39;orthogonalize&#39;: 0,</span>
<span class="go">        &#39;version&#39;: &#39;0.15.0&#39;</span>
<span class="go">    },</span>
<span class="go">    &#39;time&#39;: {</span>
<span class="go">        &#39;alg_wall_time&#39;: 0.003865957260131836,</span>
<span class="go">      &#39;cpu_proc_time&#39;: 0.021690301999999884,</span>
<span class="go">      &#39;tot_wall_time&#39;: 0.0040010069496929646</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
<p><strong>Large matrix:</strong></p>
<p>Compute the trace of <span class="math notranslate nohighlight">\(\mathbf{A}\)</span> for a very large sparse
matrix using at least <cite>100</cite> samples. Note that the matrix
<span class="math notranslate nohighlight">\(\mathbf{A}\)</span> should be symmetric.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generate a matrix of size one million. Set gram=True to create</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># a symmetric matrix needed for slq method.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">toeplitz</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">gram</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Approximate trace using stochastic Lanczos quadrature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># with at least 100 Monte-Carlo sampling</span>
<span class="hll"><span class="gp">&gt;&gt;&gt; </span><span class="n">tr</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">trace</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slq&#39;</span><span class="p">,</span> <span class="n">min_num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span class="hll"><span class="gp">... </span>                 <span class="n">max_num_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">return_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
<span class="go">4999763.32</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Find the time it took to compute the above</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="go">{</span>
<span class="go">    &#39;tot_wall_time&#39;: 16.101079436950386,</span>
<span class="go">    &#39;alg_wall_time&#39;: 16.08251190185547,</span>
<span class="go">    &#39;cpu_proc_time&#39;: 117.259937983</span>
<span class="go">}</span>
</pre></div>
</div>
<p>Compare the result of the above approximation with the exact solution of
the trace using the analytic relation for Toeplitz matrix. See
<a class="reference internal" href="../generated/imate.sample_matrices.toeplitz_trace.html#imate.sample_matrices.toeplitz_trace" title="imate.sample_matrices.toeplitz_trace"><code class="xref py py-func docutils literal notranslate"><span class="pre">imate.sample_matrices.toeplitz_trace()</span></code></a> for details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">imate.sample_matrices</span> <span class="kn">import</span> <span class="n">toeplitz_trace</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">toeplitz_trace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">gram</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">4999999</span>
</pre></div>
</div>
<p>It can be seen that the error of approximation is <span class="math notranslate nohighlight">\(0.008 \%\)</span>. This
accuracy is remarkable considering that the computation on such a large
matrix took only 16 seconds. Computing the trace of such a large matrix
using any of the exact methods (such as <code class="docutils literal notranslate"><span class="pre">exact</span></code> or <code class="docutils literal notranslate"><span class="pre">eigenvalue</span></code>) is
infeasible.</p>
<p><strong>Plotting:</strong></p>
<p>By setting <code class="docutils literal notranslate"><span class="pre">plot</span></code> to <cite>True</cite>, plots of samples during Monte-Carlo
iterations and the convergence of their mean are generated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">toeplitz</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">gram</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trace</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slq&#39;</span><span class="p">,</span> <span class="n">min_num_samples</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_num_samples</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
<span class="gp">... </span>      <span class="n">error_rtol</span><span class="o">=</span><span class="mf">2e-4</span><span class="p">,</span> <span class="n">confidence_level</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
<span class="gp">... </span>      <span class="n">outlier_significance_level</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/trace_slq_convergence_1.png" class="custom-dark align-center" src="../_images/trace_slq_convergence_1.png" />
<p>In the left plot, the samples are shown in circles and the cumulative mean
of the samples is shown by a solid black curve. The shaded area corresponds
to the 95% confidence interval <span class="math notranslate nohighlight">\(\pm 1.96 \sigma\)</span>, which is set by
<code class="docutils literal notranslate"><span class="pre">confidence_level=0.95</span></code>. The samples outside the interval of 99.9% are
considered outliers, which is set by the significance level
<code class="docutils literal notranslate"><span class="pre">outlier_significance_level=0.001</span></code>.</p>
<p>In the right plot, the darker shaded area in the interval <span class="math notranslate nohighlight">\([0, 20]\)</span>
shows the minimum number of samples and is set by <code class="docutils literal notranslate"><span class="pre">min_num_samples=20</span></code>.
The iterations do not stop till the minimum number of iterations is passed.
We can observe that sampling is terminated after 55 iterations where the
relative error of samples reaches 0.02% since we set <code class="docutils literal notranslate"><span class="pre">error_rtol=2e-4</span></code>.
The lighter shaded area in the interval <span class="math notranslate nohighlight">\([56, 80]\)</span> corresponds to the
iterations that were not performed to reach the specified maximum
iterations by <code class="docutils literal notranslate"><span class="pre">max_num_samples=80</span></code>.</p>
<p><strong>Matrix operator:</strong></p>
<p>Use an object of <a class="reference internal" href="../generated/imate.Matrix.html#imate.Matrix" title="imate.Matrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">imate.Matrix</span></code></a> class as an alternative method to
pass the matrix <cite>A</cite> to the <cite>trace</cite> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Import matrix operator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">imate</span> <span class="kn">import</span> <span class="n">toeplitz</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">Matrix</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generate a sample matrix (a toeplitz matrix)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">toeplitz</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">gram</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a matrix operator object from matrix A</span>
<span class="hll"><span class="gp">&gt;&gt;&gt; </span><span class="n">Aop</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute the trace of Aop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trace</span><span class="p">(</span><span class="n">Aop</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slq&#39;</span><span class="p">)</span>
<span class="go">493.08</span>
</pre></div>
</div>
<p>An advantage of passing <cite>Aop</cite> (instead of <cite>A</cite>) to the <cite>trace</cite> function
will be clear when using GPU.</p>
<p><strong>Computation on GPU:</strong></p>
<p>The argument <code class="docutils literal notranslate"><span class="pre">gpu=True</span></code> performs the computations on GPU. The following
example uses the object <cite>Aop</cite> created earlier.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute thet race of Aop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trace</span><span class="p">(</span><span class="n">Aop</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slq&#39;</span><span class="p">,</span> <span class="n">gpu</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">493.08</span>
</pre></div>
</div>
<p>The above function call triggers the object <cite>Aop</cite> to automatically load the
matrix data on the GPU.</p>
<p>One could have used <cite>A</cite> instead of <cite>Aop</cite> in the above. However, an
advantage of using <cite>Aop</cite> (instead of the matrix <cite>A</cite> directly) is that by
calling the above <cite>trace</cite> function (or another function) again on this
matrix, the data of this matrix does not have to be re-allocated on the GPU
device again. To highlight this point, call the above function again, but
this time, set <code class="docutils literal notranslate"><span class="pre">gram</span></code> to <cite>True</cite> to compute something different.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute the trace of Aop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trace</span><span class="p">(</span><span class="n">Aop</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slq&#39;</span><span class="p">,</span> <span class="n">gpu</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gram</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">493.08</span>
</pre></div>
</div>
<p>In the above example, no data is needed to be transferred from CPU host to
GPU device again. However, if <cite>A</cite> was used instead of <cite>Aop</cite>, the data would
have been transferred from CPU to GPU again for the second time. The <cite>Aop</cite>
object holds the data on GPU for later use as long as this object does no
go out of the scope of the python environment. Once the variable <cite>Aop</cite> goes
out of scope, the matrix data on all the GPU devices will be cleaned
automatically.</p>
<p><strong>Affine matrix operator:</strong></p>
<p>Use an object of <a class="reference internal" href="../generated/imate.AffineMatrixFunction.html#imate.AffineMatrixFunction" title="imate.AffineMatrixFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">imate.AffineMatrixFunction</span></code></a> to create the linear
operator</p>
<div class="math notranslate nohighlight">
\[\mathbf{A}(t) = \mathbf{A} + t \mathbf{I}.\]</div>
<p>The object <span class="math notranslate nohighlight">\(\mathbf{A}(t)\)</span> can be passed to <cite>trace</cite> function with
multiple values for the parameter <span class="math notranslate nohighlight">\(t\)</span> to compute their trace  all at
once, as follows.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Import affine matrix function</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">imate</span> <span class="kn">import</span> <span class="n">toeplitz</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">AffineMatrixFunction</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generate a sample matrix (a toeplitz matrix)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">A</span> <span class="o">=</span> <span class="n">toeplitz</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">gram</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Create a matrix operator object from matrix A</span>
<span class="hll"><span class="gp">&gt;&gt;&gt; </span><span class="n">Aop</span> <span class="o">=</span> <span class="n">AffineMatrixFunction</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># A list of parameters t to pass to Aop</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Compute the trace of Aop for all parameters t</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">trace</span><span class="p">(</span><span class="n">Aop</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;slq&#39;</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">min_num_samples</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
<span class="gp">... </span>      <span class="n">max_num_samples</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">error_rtol</span><span class="o">=</span><span class="mf">2e-3</span><span class="p">,</span> <span class="n">confidence_level</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
<span class="gp">... </span>      <span class="n">outlier_significance_level</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">[39988.03448276 54988.03448276 59988.03448276]</span>
</pre></div>
</div>
<p>The output of the verbose argument is shown below. In the results section
of the table below, each row <cite>i</cite> under the <cite>inquiry</cite> column corresponds to
each element of the parameters <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">=</span> <span class="pre">[-1,</span> <span class="pre">0.5,</span> <span class="pre">1]</span></code> that was specified by
<code class="docutils literal notranslate"><span class="pre">parameters</span></code> argument.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                                    <span class="n">results</span>                                   
<span class="o">==============================================================================</span>
     <span class="n">inquiries</span>                            <span class="n">error</span>            <span class="n">samples</span>            
<span class="o">--------------------</span>              <span class="o">---------------------</span>   <span class="o">---------</span>           
<span class="n">i</span>         <span class="n">parameters</span>       <span class="n">trace</span>    <span class="n">absolute</span>   <span class="n">relative</span>   <span class="n">num</span>   <span class="n">out</span>  <span class="n">converged</span>
<span class="o">==============================================================================</span>
<span class="mi">1</span>        <span class="o">-</span><span class="mf">1.0000e+00</span>  <span class="o">+</span><span class="mf">4.001e+04</span>   <span class="mf">7.674e+01</span>     <span class="mf">0.192</span><span class="o">%</span>    <span class="mi">98</span>     <span class="mi">0</span>       <span class="kc">True</span>
<span class="mi">2</span>         <span class="mf">5.0000e-01</span>  <span class="o">+</span><span class="mf">5.501e+04</span>   <span class="mf">7.674e+01</span>     <span class="mf">0.139</span><span class="o">%</span>    <span class="mi">98</span>     <span class="mi">0</span>       <span class="kc">True</span>
<span class="mi">3</span>         <span class="mf">1.0000e+00</span>  <span class="o">+</span><span class="mf">6.001e+04</span>   <span class="mf">7.674e+01</span>     <span class="mf">0.128</span><span class="o">%</span>    <span class="mi">98</span>     <span class="mi">0</span>       <span class="kc">True</span>

                                    <span class="n">config</span>                                    
<span class="o">==============================================================================</span>
                <span class="n">matrix</span>                            <span class="n">stochastic</span> <span class="n">estimator</span>        
<span class="o">-------------------------------------</span>    <span class="o">-------------------------------------</span>
<span class="n">gram</span><span class="p">:</span>                           <span class="kc">False</span>    <span class="n">method</span><span class="p">:</span>                           <span class="n">slq</span>
<span class="n">exponent</span><span class="p">:</span>                           <span class="mi">1</span>    <span class="n">lanczos</span> <span class="n">degree</span><span class="p">:</span>                    <span class="mi">20</span>
<span class="n">num</span> <span class="n">matrix</span> <span class="n">parameters</span><span class="p">:</span>              <span class="mi">1</span>    <span class="n">lanczos</span> <span class="n">tol</span><span class="p">:</span>                <span class="mf">2.220e-16</span>
<span class="n">data</span> <span class="nb">type</span><span class="p">:</span>                     <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>    <span class="n">orthogonalization</span><span class="p">:</span>               <span class="n">none</span>

             <span class="n">convergence</span>                                 <span class="n">error</span>                
<span class="o">-------------------------------------</span>    <span class="o">-------------------------------------</span>
<span class="nb">min</span> <span class="n">num</span> <span class="n">samples</span><span class="p">:</span>                   <span class="mi">50</span>    <span class="nb">abs</span> <span class="n">error</span> <span class="n">tol</span><span class="p">:</span>              <span class="mf">0.000e+00</span>
<span class="nb">max</span> <span class="n">num</span> <span class="n">samples</span><span class="p">:</span>                  <span class="mi">150</span>    <span class="n">rel</span> <span class="n">error</span> <span class="n">tol</span><span class="p">:</span>                  <span class="mf">0.20</span><span class="o">%</span>
<span class="n">outlier</span> <span class="n">significance</span> <span class="n">level</span><span class="p">:</span>     <span class="mf">0.00</span><span class="o">%</span>    <span class="n">confidence</span> <span class="n">level</span><span class="p">:</span>              <span class="mf">95.00</span><span class="o">%</span>

                                   <span class="n">process</span>                                    
<span class="o">==============================================================================</span>
                 <span class="n">time</span>                                   <span class="n">device</span>                
<span class="o">-------------------------------------</span>    <span class="o">-------------------------------------</span>
<span class="n">tot</span> <span class="n">wall</span> <span class="n">time</span> <span class="p">(</span><span class="n">sec</span><span class="p">):</span>        <span class="mf">3.226e-02</span>    <span class="n">num</span> <span class="n">cpu</span> <span class="n">threads</span><span class="p">:</span>                    <span class="mi">8</span>
<span class="n">alg</span> <span class="n">wall</span> <span class="n">time</span> <span class="p">(</span><span class="n">sec</span><span class="p">):</span>        <span class="mf">3.004e-02</span>    <span class="n">num</span> <span class="n">gpu</span> <span class="n">devices</span><span class="p">,</span> <span class="n">multiproc</span><span class="p">:</span>     <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span>
<span class="n">cpu</span> <span class="n">proc</span> <span class="n">time</span> <span class="p">(</span><span class="n">sec</span><span class="p">):</span>        <span class="mf">2.334e-01</span>    <span class="n">num</span> <span class="n">gpu</span> <span class="n">threads</span> <span class="n">per</span> <span class="n">multiproc</span><span class="p">:</span>      <span class="mi">0</span>

</pre></div>
</div>
<p>The output of the plot is shown below. Each colored curve corresponds to
a parameter in <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">=</span> <span class="pre">[-1,</span> <span class="pre">0.5,</span> <span class="pre">1]</span></code>.</p>
<a class="custom-dark reference internal image-reference" href="../_images/trace_slq_convergence_2.png"><img alt="../_images/trace_slq_convergence_2.png" class="custom-dark align-center" src="../_images/trace_slq_convergence_2.png" style="width: 80%;" /></a>
</dd></dl>

</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="imate.trace.eigenvalue.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">imate.trace(method=’eigenvalue’)</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../generated/imate.schatten.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">imate.schatten</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  

<div class="tocsection editthispage">
    <a href="https://github.com/https://github.com/ameli/imate/edit/main/docs/source/api/imate.trace.slq.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=9b1a4fa89bdd0e95b23b"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022, Siavash Ameli.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>